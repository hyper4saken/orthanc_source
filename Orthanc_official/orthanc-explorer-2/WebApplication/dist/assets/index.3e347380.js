var ue=Object.defineProperty,ce=Object.defineProperties;var he=Object.getOwnPropertyDescriptors;var Q=Object.getOwnPropertySymbols;var pe=Object.prototype.hasOwnProperty,_e=Object.prototype.propertyIsEnumerable;var Y=(e,t,i)=>t in e?ue(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,$=(e,t)=>{for(var i in t||(t={}))pe.call(t,i)&&Y(e,i,t[i]);if(Q)for(var i of Q(t))_e.call(t,i)&&Y(e,i,t[i]);return e},R=(e,t)=>ce(e,he(t));import{r as S,o as n,c as l,a as s,b as y,d as v,e as ye,m as C,t as _,n as g,F as I,f as w,p as O,g as N,h as p,i as h,j as K,$ as q,k as Z,l as U,w as M,q as E,s as f,v as W,u as fe,x as X,y as k,z as T,A as L,U as me,B as be,C as ge,D as Se,V as De}from"./vendor.7dbb0357.js";const ve=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))u(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const c of a.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&u(c)}).observe(document,{childList:!0,subtree:!0});function i(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerpolicy&&(a.referrerPolicy=o.referrerpolicy),o.crossorigin==="use-credentials"?a.credentials="include":o.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function u(o){if(o.ep)return;o.ep=!0;const a=i(o);fetch(o.href,a)}};ve();var F=(e,t)=>{const i=e.__vccOpts||e;for(const[u,o]of t)i[u]=o;return i};const Ie={async created(){console.log("Creating App..."),await this.$store.dispatch("configuration/load"),await this.$store.dispatch("studies/initialLoad"),console.log("App created")}},we={class:"full-page"},Fe={class:"nav-side-layout"},Me=s("div",{class:"mt-5"},"This is a beta version !",-1),Pe={class:"content"};function $e(e,t,i,u,o,a){const c=S("router-view");return n(),l("div",we,[s("div",Fe,[y(c,{name:"SideBarView"}),Me]),s("div",Pe,[y(c,{name:"ContentView"})])])}var xe=F(Ie,[["render",$e]]);var ee=window.location.pathname.slice(0,-1),m="../../",ke="../api/";const Ce={UiOptions:{EnableUpload:!0,EnableDeleteResources:!0,EnableApiViewMenu:!0,EnableSettings:!0,MaxStudiesDisplayed:50,UploadReportTags:["AccessionNumber","StudyDate","PatientName","PatientID","StudyDescription"],UploadReportMaxTags:2,StudyListColumns:["PatientBirthDate","PatientName","PatientID","StudyDescription","StudyDate","modalities","AccessionNumber","seriesCount"]},Plugins:{"dicom-web":{Description:"Implementation of DICOMweb (QIDO-RS, STOW-RS and WADO-RS) and WADO-URI.",Enabled:!0,ExtendsOrthancExplorer:!0,ID:"dicom-web",RootUri:"../dicom-web/app/client/index.html",Version:"mainline"},"osimis-web-viewer":{Description:"Provides a Web viewer of DICOM series within Orthanc.",ExtendsOrthancExplorer:!0,ID:"osimis-web-viewer",Version:"1.4.2.0-9d9eff4",Enabled:!1},"stone-webviewer":{Enabled:!0,ExtendsOrthancExplorer:!0,ID:"stone-webviewer",Version:"2.2"}}};var b={async loadOe2Configuration(){try{return(await v.get(ke+"configuration")).data}catch(e){return console.error("Error while loading OE2 configuration: ",e),Ce}},async loadDicomWebServers(){return(await v.get(m+"dicom-web/servers")).data},async loadOrthancPeers(){return(await v.get(m+"peers")).data},async loadDicomModalities(){return(await v.get(m+"modalities")).data},async loadSystem(){return(await v.get(m+"system")).data},async sendToDicomWebServer(e,t){return(await v.post(m+"dicom-web/servers/"+t+"/stow",{Resources:e,Synchronous:!1})).data.ID},async sendToOrthancPeer(e,t){return(await v.post(m+"peers/"+t+"/store",{Resources:e,Synchronous:!1})).data.ID},async sendToOrthancPeerWithTransfers(e,t){return(await v.post(m+"transfers/send",{Resources:e,Compression:"gzip",Peer:t,Synchronous:!1})).data.ID},async sendToDicomModality(e,t){return(await v.post(m+"modalities/"+t+"/store",{Resources:e,Synchronous:!1})).data.ID},async getJobStatus(e){return(await v.get(m+"jobs/"+e)).data},async deleteResource(e,t){return v.delete(m+this.pluralizeResourceLevel(e)+"/"+t)},async cancelFindStudies(){window.axioFindStudiesAbortController&&(window.axioFindStudiesAbortController.abort(),window.axioFindStudiesAbortController=null)},async findStudies(e){return await this.cancelFindStudies(),window.axioFindStudiesAbortController=new AbortController,v.post(m+"tools/find",{Level:"Study",Limit:se.state.configuration.uiOptions.MaxStudiesDisplayed,Query:e,RequestedTags:["ModalitiesInStudy"],Expand:!0},{signal:window.axioFindStudiesAbortController.signal})},async cancelRemoteDicomFindStudies(){window.axioRemoteDicomFindStudiesAbortController&&(window.axioRemoteDicomFindStudiesAbortController.abort(),window.axioRemoteDicomFindStudiesAbortController=null)},async remoteDicomFindStudies(e,t){await this.cancelRemoteDicomFindStudies(),window.axioRemoteDicomFindStudiesAbortController=new AbortController;try{const i=(await v.post(m+"modalities/"+e+"/query",{Level:"Study",Query:t},{signal:window.axioRemoteDicomFindStudiesAbortController.signal})).data;console.log(i);const u=(await v.get(m+"queries/"+i.ID+"/answers?expand&simplify")).data;return console.log(u),u}catch(i){return console.log("Error during query:",i),{}}},async remoteDicomRetrieveStudy(e,t,i,u){return(await v.post(m+"modalities/"+e+"/move",{Level:u,Resources:[t],TargetAet:i,Synchronous:!1})).data.ID},async remoteModalityEcho(e){return v.post(m+"modalities/"+e+"/echo",{})},async uploadFile(e){return v.post(m+"instances",e)},async getStudy(e){return v.get(m+"studies/"+e+"?requestedTags=ModalitiesInStudy")},async getStudySeries(e){return v.get(m+"studies/"+e+"/series")},async getExpandedSeries(e){return v.get(m+"series/"+e+"?expand")},async getSeriesInstances(e){return v.get(m+"series/"+e+"/instances")},async getInstanceTags(e){return v.get(m+"instances/"+e+"/tags")},async getInstanceHeader(e){return v.get(m+"instances/"+e+"/header")},async getStatistics(){return v.get(m+"statistics")},async setVerboseLevel(e){await v.put(m+"tools/log-level",e)},async getVerboseLevel(){return(await v.get(m+"tools/log-level")).data},getOsimisViewerUrl(e,t){return m+"osimis-viewer/app/index.html?"+e+"="+t},getStoneViewerUrl(e,t){return m+"stone-webviewer/index.html?"+e+"="+t},getInstancePreviewUrl(e){return m+"instances/"+e+"/preview"},getInstanceDownloadUrl(e){return m+"instances/"+e+"/file"},getDownloadZipUrl(e,t){return m+this.pluralizeResourceLevel(e)+"/"+t+"/archive"},getDownloadDicomDirUrl(e,t){return m+this.pluralizeResourceLevel(e)+"/"+t+"/media"},getApiUrl(e,t,i){return m+this.pluralizeResourceLevel(e)+"/"+t+i},pluralizeResourceLevel(e){if(e=="study")return"studies";if(e=="instance")return"instances";if(e=="patient")return"patients";if(e=="series")return"series"}};const Oe=()=>({installedPlugins:{},orthancPeers:[],targetDicomWebServers:[],queryableDicomWebServers:[],queryableDicomModalities:[],targetDicomModalities:[],maxStudiesDisplayed:100,orthancApiUrl:"../../",uiOptions:{},loaded:!1,system:{}}),Ne={},Ue={setUiOptions(e,{uiOptions:t}){e.uiOptions=t},setInstalledPlugin(e,{plugin:t,pluginConfiguration:i}){e.installedPlugins[t]=i},setDicomWebServers(e,{dicomWebServers:t}){e.targetDicomWebServers=t,e.queryableDicomWebServers=t},setOrthancPeers(e,{orthancPeers:t}){e.orthancPeers=t},setDicomModalities(e,{dicomModalities:t}){e.queryableDicomModalities=t,e.targetDicomModalities=t},setSystem(e,{system:t}){e.system=t},setLoaded(e){e.loaded=!0}},Re={async load({commit:e,state:t}){await this.dispatch("configuration/loadOe2Configuration");const i=await b.loadOrthancPeers();e("setOrthancPeers",{orthancPeers:i});const u=await b.loadDicomModalities();e("setDicomModalities",{dicomModalities:u});const o=await b.loadSystem();e("setSystem",{system:o}),e("setLoaded")},async loadOe2Configuration({commit:e}){const t=await b.loadOe2Configuration();e("setUiOptions",{uiOptions:t.UiOptions});for(const[i,u]of Object.entries(t.Plugins))if(e("setInstalledPlugin",{plugin:i,pluginConfiguration:u}),i==="dicom-web"){const o=await b.loadDicomWebServers();e("setDicomWebServers",{dicomWebServers:o})}}};var Te={namespaced:!0,state:Oe,getters:Ne,mutations:Ue,actions:Re};const te={StudyDate:"",AccessionNumber:"",PatientID:"",PatientName:"",PatientBirthDate:"",StudyDescription:"",StudyInstanceUID:"",ModalitiesInStudy:""},Le=()=>({studies:[],studiesIds:[],filters:$({},te),statistics:{},isSearching:!1}),Ae={filterQuery:e=>{let t={};return e.filters.StudyDate.length>=8&&(t.StudyDate=e.filters.StudyDate),e.filters.AccessionNumber.length>=1&&(t.AccessionNumber="*"+e.filters.AccessionNumber+"*"),e.filters.PatientID.length>=1&&(t.PatientID="*"+e.filters.PatientID+"*"),e.filters.PatientName.length>=1&&(t.PatientName="*"+e.filters.PatientName+"*"),e.filters.PatientBirthDate.length>=8&&(t.PatientBirthDate=e.filters.PatientBirthDate),e.filters.StudyDescription.length>=1&&(t.StudyDescription="*"+e.filters.StudyDescription+"*"),e.filters.StudyInstanceUID.length>=1&&(t.StudyInstanceUID=e.filters.StudyInstanceUID),e.filters.ModalitiesInStudy.length>=1&&(t.ModalitiesInStudy=e.filters.ModalitiesInStudy),t},isFilterEmpty:(e,t)=>Object.keys(t.filterQuery).length==0},Ee={setStudiesIds(e,{studiesIds:t}){e.studiesIds=t},setStudies(e,{studies:t}){e.studies=t},addStudy(e,{studyId:t,study:i}){e.studiesIds.includes(t)||(e.studiesIds.push(t),e.studies.push(i))},setFilter(e,{dicomTagName:t,value:i}){e.filters[t]=i},clearFilter(e){e.filters=$({},te)},deleteStudy(e,{studyId:t}){const i=e.studiesIds.indexOf(t);i>=0&&e.studiesIds.splice(i,1),e.studies=e.studies.map(u=>u.ID!=t)},setStatistics(e,{statistics:t}){e.statistics=t},setIsSearching(e,{isSearching:t}){e.isSearching=t}},Be={async initialLoad({commit:e,state:t}){this.dispatch("studies/loadStatistics")},async updateFilter({commit:e},t){const i=t.dicomTagName,u=t.value;e("setFilter",{dicomTagName:i,value:u}),this.dispatch("studies/reloadFilteredStudies")},async updateFilterNoReload({commit:e},t){const i=t.dicomTagName,u=t.value;e("setFilter",{dicomTagName:i,value:u})},async clearFilter({commit:e,state:t}){e("clearFilter"),this.dispatch("studies/reloadFilteredStudies")},async clearFilterNoReload({commit:e}){e("clearFilter")},async reloadFilteredStudies({commit:e,getters:t}){if(t.isFilterEmpty&&this.state.configuration.uiOptions.StudyListEmptyIfNoSearch)e("setStudiesIds",{studiesIds:[]}),e("setStudies",{studies:[]});else try{e("setIsSearching",{isSearching:!0});const i=(await b.findStudies(t.filterQuery)).data;let u=i.map(o=>o.ID);e("setStudiesIds",{studiesIds:u}),e("setStudies",{studies:i})}catch{console.log("Find studies cancelled")}finally{e("setIsSearching",{isSearching:!1})}},async cancelSearch(){await b.cancelFindStudies()},async loadStatistics({commit:e}){const t=(await b.getStatistics()).data;e("setStatistics",{statistics:t})},async deleteStudy({commit:e},t){const i=t.studyId;e("deleteStudy",{studyId:i}),this.dispatch("studies/loadStatistics")},async addStudy({commit:e},t){const i=t.studyId,u=t.study;e("addStudy",{studyId:i,study:u}),this.dispatch("studies/loadStatistics")}};var Ve={namespaced:!0,state:Le,getters:Ae,mutations:Ee,actions:Be};const je=()=>({jobs:{},jobsIds:[],maxJobsInHistory:5}),qe={},We={addJob(e,{jobId:t,name:i}){const u={id:t,name:i,isRunning:!0,status:null};e.jobsIds.push(t),e.jobs[t]=u},removeJob(e,{jobId:t}){const i=e.jobsIds.indexOf(t);i>=0&&e.jobsIds.splice(i,1),delete e.jobs[t]}},Je={addJob({commit:e,state:t},i){const u=i.jobId,o=i.name;if(e("addJob",{jobId:u,name:o}),this.state.configuration.uiOptions.MaxMyJobsHistorySize>0)for(;t.jobsIds.length>this.state.configuration.uiOptions.MaxMyJobsHistorySize;)e("removeJob",{jobId:t.jobsIds[0]})},removeJob({commit:e},t){const i=t.jobId;e("removeJob",{jobId:i})}};var ze={namespaced:!0,state:je,getters:qe,mutations:We,actions:Je};const He=!1;var se=ye({modules:{studies:Ve,configuration:Te,jobs:ze},strict:He,plugins:[]});const Ge={props:[],emits:[],data(){return{verboseLevel:"default"}},async mounted(){this.verboseLevel=await b.getVerboseLevel()},methods:{async setVerboseLevel(e){this.verboseLevel=e,await b.setVerboseLevel(e)}},computed:R($({},C({uiOptions:e=>e.configuration.uiOptions,statistics:e=>e.studies.statistics,system:e=>e.configuration.system,installedPlugins:e=>e.configuration.installedPlugins})),{totalDiskSize(){return this.statistics.TotalDiskSizeMB>1024*1024?Math.round(this.statistics.TotalDiskSizeMB/(1024*1024)*100)/100+" TB":this.statistics.TotalDiskSizeMB>1024?Math.round(this.statistics.TotalDiskSizeMB/1024*100)/100+" GB":this.statistics.TotalDiskSizeMB+" MB"}})},P=e=>(O("data-v-305014eb"),e=e(),N(),e),Qe={class:"settings"},Ye=P(()=>s("h5",null,"Statistics",-1)),Ke={class:"table"},Ze=P(()=>s("th",{scope:"row",class:"w-50 header"},"# Studies",-1)),Xe={class:"value"},et=P(()=>s("th",{scope:"row",class:"header"},"# Series",-1)),tt={class:"value"},st=P(()=>s("th",{scope:"row",class:"header"},"# Instances",-1)),it={class:"value"},ot=P(()=>s("th",{scope:"row",class:"header"},"Storage size",-1)),at={class:"value"},nt=P(()=>s("h5",null,"Orthanc System info",-1)),lt={class:"table"},rt=P(()=>s("th",{scope:"row",class:"w-50 header"},"Orthanc version",-1)),dt={class:"value"},ut=P(()=>s("th",{scope:"row",class:"header"},"DICOM AET",-1)),ct={class:"value"},ht=P(()=>s("th",{scope:"row",class:"header"},"Orthanc Name",-1)),pt={class:"value"},_t=P(()=>s("th",{scope:"row",class:"header"},"Dicom Port",-1)),yt={class:"value"},ft=P(()=>s("th",{scope:"row",class:"header"},"Ingest Transcoding",-1)),mt={class:"value"},bt=P(()=>s("th",{scope:"row",class:"header"},"Overwrite Instances",-1)),gt={class:"value"},St=P(()=>s("th",{scope:"row",class:"header"},"Storage Compression",-1)),Dt={class:"value"},vt=P(()=>s("h5",null,"Verbosity level",-1)),It=P(()=>s("h5",null,"Installed plugins",-1)),wt=P(()=>s("p",{class:"m-2"},[p("Plugins that are loaded but not enabled or not configured correctly are "),s("span",{style:{"text-decoration":"line-through"}},"striked-through")],-1)),Ft={class:"table"},Mt={scope:"row",class:"w-25 header"},Pt={class:"w-50 value"},$t={class:"w-15 value"},xt={class:"w-10 value"},kt=["href"];function Ct(e,t,i,u,o,a){return n(),l("div",Qe,[s("div",null,[Ye,s("table",Ke,[s("tbody",null,[s("tr",null,[Ze,s("td",Xe,_(e.statistics.CountStudies),1)]),s("tr",null,[et,s("td",tt,_(e.statistics.CountSeries),1)]),s("tr",null,[st,s("td",it,_(e.statistics.CountInstances),1)]),s("tr",null,[ot,s("td",at,_(a.totalDiskSize),1)])])])]),s("div",null,[nt,s("table",lt,[s("tbody",null,[s("tr",null,[rt,s("td",dt,_(e.system.Version),1)]),s("tr",null,[ut,s("td",ct,_(e.system.DicomAet),1)]),s("tr",null,[ht,s("td",pt,_(e.system.Name),1)]),s("tr",null,[_t,s("td",yt,_(e.system.DicomPort),1)]),s("tr",null,[ft,s("td",mt,_(e.system.IngestTranscoding),1)]),s("tr",null,[bt,s("td",gt,_(e.system.OverwriteInstances),1)]),s("tr",null,[St,s("td",Dt,_(e.system.StorageCompression),1)])])])]),s("div",null,[vt,s("div",null,[s("button",{type:"button",class:g(["btn mx-2",{"btn-primary":o.verboseLevel=="default","btn-secondary":o.verboseLevel!="default"}]),onClick:t[0]||(t[0]=c=>a.setVerboseLevel("default"))},"Default",2),s("button",{type:"button",class:g(["btn mx-2",{"btn-primary":o.verboseLevel=="verbose","btn-secondary":o.verboseLevel!="verbose"}]),onClick:t[1]||(t[1]=c=>a.setVerboseLevel("verbose"))},"Verbose",2),s("button",{type:"button",class:g(["btn mx-2",{"btn-primary":o.verboseLevel=="trace","btn-secondary":o.verboseLevel!="trace"}]),onClick:t[2]||(t[2]=c=>a.setVerboseLevel("trace"))},"Trace",2)])]),s("div",null,[It,wt,s("table",Ft,[s("tbody",null,[(n(!0),l(I,null,w(e.installedPlugins,(c,r)=>(n(),l("tr",{key:r,class:g({"disabled-plugin":!c.Enabled})},[s("th",Mt,_(r),1),s("td",Pt,_(c.Description),1),s("td",$t,_(c.Version),1),s("td",xt,[c.RootUri&&c.Enabled?(n(),l("a",{key:0,type:"button",class:"btn btn-primary",href:c.RootUri},"Open",8,kt)):h("",!0)])],2))),128))])])])])}var Ot=F(Ge,[["render",Ct],["__scopeId","data-v-305014eb"]]);const Nt={props:["id","headerText","bodyText","cancelText","okText"],methods:{ok(){this.$emit("ok")}},mounted(){this.$refs["modal-main-div"].addEventListener("show.bs.modal",e=>{document.querySelector("body").appendChild(e.target)})}},Ut=["id"],Rt={class:"modal-dialog"},Tt={class:"modal-content"},Lt={class:"modal-header"},At=["innerHTML"],Et=s("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),Bt={class:"modal-body"},Vt={class:"modal-footer"},jt={key:0,type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"};function qt(e,t,i,u,o,a){return n(),l("div",{class:"modal fade",id:this.id,tabindex:"-1","aria-labelledby":"modalLabel",ref:"modal-main-div"},[s("div",Rt,[s("div",Tt,[s("div",Lt,[s("h5",{class:"modal-title",id:"modalLabel",innerHTML:i.headerText},null,8,At),Et]),s("div",Bt,[K(e.$slots,"modalBody")]),s("div",Vt,[i.cancelText?(n(),l("button",jt,_(i.cancelText),1)):h("",!0),s("button",{type:"button",class:"btn btn-primary","data-bs-dismiss":"modal",onClick:t[0]||(t[0]=c=>a.ok())},_(i.okText),1)])])])],8,Ut)}var J=F(Nt,[["render",qt]]);const Wt={props:["resourceOrthancId","resourceDicomUid","resourceLevel","customClass"],setup(){return{}},data(){return{isDeleteModalVisible:!1}},mounted(){},methods:{toggleSubMenu(e){let t=e.target.parentElement;e.target.tagName=="I"&&(t=t.parentElement),q(t.querySelector(".dropdown-menu")).toggle(),e.stopPropagation(),e.preventDefault()},deleteResource(e){b.deleteResource(this.resourceLevel,this.resourceOrthancId).then(()=>{this.$emit("deletedResource")}).catch(t=>{console.error("failed to delete resource : ",this.resourceOrthancId,t)})},getApiUrl(e){return b.getApiUrl(this.resourceLevel,this.resourceOrthancId,e)},async sendToDicomWebServer(e){const t=await b.sendToDicomWebServer([this.resourceOrthancId],e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Send to DicomWeb ("+e+")"})},async sendToOrthancPeer(e){const t=await b.sendToOrthancPeer([this.resourceOrthancId],e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Send to Peer ("+e+")"})},async sendToOrthancPeerWithTransfers(e){const t=await b.sendToOrthancPeerWithTransfers([{Level:this.capitalizeFirstLetter(this.resourceLevel),ID:this.resourceOrthancId}],e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Transfer to Peer ("+e+")"})},async sendToDicomModality(e){const t=await b.sendToDicomModality([this.resourceOrthancId],e);this.$store.dispatch("jobs/addJob",{jobId:t,name:"Send to DICOM ("+e+")"})},capitalizeFirstLetter(e){return e.charAt(0).toUpperCase()+e.slice(1)}},computed:R($({},C({uiOptions:e=>e.configuration.uiOptions,installedPlugins:e=>e.configuration.installedPlugins,targetDicomWebServers:e=>e.configuration.targetDicomWebServers,targetDicomModalities:e=>e.configuration.targetDicomModalities,orthancPeers:e=>e.configuration.orthancPeers})),{hasSendTo(){return this.hasSendToDicomWeb||this.hasSendToPeers||this.hasSendToDicomModalities||this.hasSendToPeersWithTransfer},hasSendToPeers(){return this.orthancPeers.length>0},hasSendToPeersWithTransfer(){return this.hasSendToPeers&&"transfers"in this.installedPlugins},hasSendToDicomWeb(){return this.targetDicomWebServers.length>0},hasSendToDicomModalities(){return this.targetDicomModalities.length>0},hasOsimisViewer(){return"osimis-web-viewer"in this.installedPlugins},osimisViewerUrl(){return b.getOsimisViewerUrl(this.resourceLevel,this.resourceOrthancId)},hasStoneViewer(){return"stone-webviewer"in this.installedPlugins},stoneViewerUrl(){return b.getStoneViewerUrl(this.resourceLevel,this.resourceDicomUid)},hasOhifViewer(){return this.uiOptions.EnableOpenInOhifViewer},ohifViewerUrl(){return this.uiOptions.OhifViewerPublicRoot+this.resourceDicomUid},hasMedDreamViewer(){return this.uiOptions.EnableOpenInMedDreamViewer},medDreamViewerUrl(){return this.uiOptions.MedDreamViewerPublicRoot+"?study="+this.resourceDicomUid},instancePreviewUrl(){return b.getInstancePreviewUrl(this.resourceOrthancId)},instanceDownloadUrl(){return b.getInstanceDownloadUrl(this.resourceOrthancId)},downloadZipUrl(){return b.getDownloadZipUrl(this.resourceLevel,this.resourceOrthancId)},downloadDicomDirUrl(){return b.getDownloadDicomDirUrl(this.resourceLevel,this.resourceOrthancId)}}),components:{Modal:J}},Jt={class:"d-grid d-lg-block gap-2"},zt=["href"],Ht=s("i",{class:"bi bi-eye"},null,-1),Gt=[Ht],Qt=["href"],Yt=s("i",{class:"bi bi-eye-fill"},null,-1),Kt=[Yt],Zt=["href"],Xt=s("i",{class:"bi bi-grid"},null,-1),es=[Xt],ts=["href"],ss=s("i",{class:"bi bi-columns-gap"},null,-1),is=[ss],os=["href"],as=s("i",{class:"bi bi-binoculars"},null,-1),ns=[as],ls=["href"],rs=s("i",{class:"bi bi-download"},null,-1),ds=[rs],us=["href"],cs=s("i",{class:"bi bi-box-arrow-down"},null,-1),hs=[cs],ps=["href"],_s=s("i",{class:"bi bi-download"},null,-1),ys=[_s],fs=["data-bs-target"],ms=s("i",{class:"bi bi-trash","data-bs-toggle":"tooltip",title:"Delete"},null,-1),bs=[ms],gs={key:10,class:"dropdown btn btn-sm btn-secondary m-1 dropdown-toggle",type:"button",id:"apiDropdownMenuId","data-bs-toggle":"dropdown","aria-expanded":"false"},Ss=s("span",{"data-bs-toggle":"tooltip",title:"API"},[s("i",{class:"bi bi-code-slash"})],-1),Ds=[Ss],vs={class:"dropdown-menu bg-dropdown","aria-labelledby":"apiDropdownMenuId"},Is={class:"dropdown-item",href:"#"},ws=["href"],Fs={key:0},Ms=["href"],Ps=["href"],$s=["href"],xs={key:11,class:"dropdown btn btn-sm btn-secondary m-1 dropdown-toggle",type:"button",id:"dropdownMenuId","data-bs-toggle":"dropdown","aria-expanded":"false"},ks=s("span",{"data-bs-toggle":"tooltip",title:"Send"},[s("i",{class:"bi bi-send"})],-1),Cs=[ks],Os={class:"dropdown-menu bg-dropdown","aria-labelledby":"dropdownMenuId"},Ns={key:0,class:"dropdown-submenu"},Us=p(" Orthanc peers "),Rs=s("i",{class:"bi bi-caret-down"},null,-1),Ts=[Us,Rs],Ls={class:"dropdown-menu bg-dropdown"},As=["onClick"],Es={key:1,class:"dropdown-submenu"},Bs=p(" Advanced transfers "),Vs=s("i",{class:"bi bi-caret-down"},null,-1),js=[Bs,Vs],qs={class:"dropdown-menu bg-dropdown"},Ws=["onClick"],Js={key:2,class:"dropdown-submenu"},zs=p(" Dicom WEB "),Hs=s("i",{class:"bi bi-caret-down"},null,-1),Gs=[zs,Hs],Qs={class:"dropdown-menu bg-dropdown"},Ys=["onClick"],Ks={key:3,class:"dropdown-submenu"},Zs=p(" DICOM "),Xs=s("i",{class:"bi bi-caret-down"},null,-1),ei=[Zs,Xs],ti={class:"dropdown-menu bg-dropdown"},si=["onClick"];function ii(e,t,i,u,o,a){const c=S("Modal"),r=Z("clipboard");return n(),l("div",Jt,[a.hasOsimisViewer&&(this.resourceLevel=="study"||this.resourceLevel=="series")?(n(),l("a",{key:0,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"View in OsimisViewer",target:"blank",href:a.osimisViewerUrl},Gt,8,zt)):h("",!0),a.hasStoneViewer&&this.resourceLevel=="study"?(n(),l("a",{key:1,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"View in StoneViewer",target:"blank",href:a.stoneViewerUrl},Kt,8,Qt)):h("",!0),a.hasOhifViewer&&this.resourceLevel=="study"?(n(),l("a",{key:2,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"View in OHIF",target:"blank",href:a.ohifViewerUrl},es,8,Zt)):h("",!0),a.hasMedDreamViewer&&this.resourceLevel=="study"?(n(),l("a",{key:3,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"View in MedDream",target:"blank",href:a.medDreamViewerUrl},is,8,ts)):h("",!0),this.resourceLevel=="instance"?(n(),l("a",{key:4,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"Preview",target:"blank",href:a.instancePreviewUrl},ns,8,os)):h("",!0),e.uiOptions.EnableDownloadZip&&this.resourceLevel!="instance"?(n(),l("a",{key:5,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"Download ZIP",href:a.downloadZipUrl},ds,8,ls)):h("",!0),e.uiOptions.EnableDownloadDicomDir&&this.resourceLevel!="instance"?(n(),l("a",{key:6,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"Download DICOMDIR",href:a.downloadDicomDirUrl},hs,8,us)):h("",!0),e.uiOptions.EnableDownloadDicomFile&&this.resourceLevel=="instance"?(n(),l("a",{key:7,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"Download DICOM file",href:a.instanceDownloadUrl},ys,8,ps)):h("",!0),e.uiOptions.EnableDeleteResources?(n(),l("button",{key:8,class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"modal","data-bs-target":"#delete-modal-"+this.resourceOrthancId},bs,8,fs)):h("",!0),e.uiOptions.EnableDeleteResources?(n(),U(c,{key:9,id:"delete-modal-"+this.resourceOrthancId,headerText:"Delete "+this.resourceLevel+" ?",okText:"Delete",cancelText:"Cancel",bodyText:"Are you sure you want to delete this "+this.resourceLevel+" ?<br/>  This action can not be undone !",onOk:t[0]||(t[0]=d=>a.deleteResource(d))},null,8,["id","headerText","bodyText"])):h("",!0),e.uiOptions.EnableApiViewMenu?(n(),l("button",gs,Ds)):h("",!0),s("ul",vs,[s("li",null,[M((n(),l("button",Is,[p("copy "+_(this.resourceLevel)+" orthanc id",1)])),[[r,this.resourceOrthancId,"copy"]])]),s("li",null,[s("a",{class:"dropdown-item",target:"blank",href:a.getApiUrl("")},"/",8,ws)]),this.resourceLevel=="instance"?(n(),l("li",Fs,[s("a",{class:"dropdown-item",target:"blank",href:a.getApiUrl("/tags?simplify")},"/tags?simplify",8,Ms)])):h("",!0),s("li",null,[s("a",{class:"dropdown-item",target:"blank",href:a.getApiUrl("/metadata?expand")},"/metadata",8,Ps)]),s("li",null,[s("a",{class:"dropdown-item",target:"blank",href:a.getApiUrl("/attachments?expand")},"/attachments",8,$s)])]),a.hasSendTo?(n(),l("button",xs,Cs)):h("",!0),s("ul",Os,[a.hasSendToPeers?(n(),l("li",Ns,[s("a",{class:"dropdown-item",onClick:t[1]||(t[1]=(...d)=>a.toggleSubMenu&&a.toggleSubMenu(...d)),href:"#"},Ts),s("ul",Ls,[(n(!0),l(I,null,w(e.orthancPeers,d=>(n(),l("li",{key:d},[s("a",{class:"dropdown-item",onClick:D=>a.sendToOrthancPeer(d)},_(d),9,As)]))),128))])])):h("",!0),a.hasSendToPeersWithTransfer?(n(),l("li",Es,[s("a",{class:"dropdown-item",onClick:t[2]||(t[2]=(...d)=>a.toggleSubMenu&&a.toggleSubMenu(...d)),href:"#"},js),s("ul",qs,[(n(!0),l(I,null,w(e.orthancPeers,d=>(n(),l("li",{key:d},[s("a",{class:"dropdown-item",onClick:D=>a.sendToOrthancPeerWithTransfers(d)},_(d),9,Ws)]))),128))])])):h("",!0),a.hasSendToDicomWeb?(n(),l("li",Js,[s("a",{class:"dropdown-item",onClick:t[3]||(t[3]=(...d)=>a.toggleSubMenu&&a.toggleSubMenu(...d)),href:"#"},Gs),s("ul",Qs,[(n(!0),l(I,null,w(e.targetDicomWebServers,d=>(n(),l("li",{key:d},[s("a",{class:"dropdown-item",onClick:D=>a.sendToDicomWebServer(d)},_(d),9,Ys)]))),128))])])):h("",!0),a.hasSendToDicomModalities?(n(),l("li",Ks,[s("a",{class:"dropdown-item",onClick:t[4]||(t[4]=(...d)=>a.toggleSubMenu&&a.toggleSubMenu(...d)),href:"#"},ei),s("ul",ti,[(n(!0),l(I,null,w(e.targetDicomModalities,d=>(n(),l("li",{key:d},[s("a",{class:"dropdown-item",onClick:D=>a.sendToDicomModality(d)},_(d),9,si)]))),128))])])):h("",!0)])])}var z=F(Wt,[["render",ii]]);const oi={props:["valueToCopy"],setup(){return{}},data(){return{isSuccess:!1,isError:!1}},mounted(){},methods:{onSuccess(){console.log("copied to clipboard: "+this.valueToCopy),this.isSuccess=!0,this.isError=!1,setTimeout(()=>{this.isSuccess=!1},2500)},onError(){console.log("failed to copy to clipboard"),this.isSuccess=!1,this.isError=!0,setTimeout(()=>{this.isError=!1},2500)}},computed:{},components:{}},ai={key:0,class:"bi-check"},ni={key:1,class:"bi-bug"},li={key:2,class:"bi-clipboard"};function ri(e,t,i,u,o,a){const c=Z("clipboard");return this.valueToCopy!==void 0?M((n(),l("button",{key:0,class:g(["btn-clipboard",{success:o.isSuccess,error:o.isError}]),type:"button","data-bs-toggle":"tooltip",title:"Copy to clipboard"},[this.isSuccess?(n(),l("i",ai)):h("",!0),this.isError?(n(),l("i",ni)):h("",!0),!this.isSuccess&&!this.isError?(n(),l("i",li)):h("",!0)],2)),[[c,this.valueToCopy,"copy"],[c,a.onSuccess,"success"],[c,a.onError,"error"]]):h("",!0)}var ie=F(oi,[["render",ri]]);const di={props:["tags"],data(){return{}},mounted(){},computed:{},methods:{},components:{CopyToClipboardButton:ie}},ui={key:0},ci={class:"details-label"},hi={key:1,class:"d-flex w-100"},pi={class:"details-label"},_i={key:0,class:"details"};function yi(e,t,i,u,o,a){const c=S("tags-tree",!0),r=S("CopyToClipboardButton");return n(),l("ul",null,[(n(!0),l(I,null,w(i.tags,(d,D)=>(n(),l("li",{key:D},[d.Type=="Sequence"?(n(),l("span",ui,[s("span",ci,_(D)+" - "+_(d.Name)+": ",1),s("ul",null,[(n(!0),l(I,null,w(d.Value,(j,de)=>(n(),l("li",{key:j},[p(" Item "+_(de+1)+" ",1),y(c,{tags:j},null,8,["tags"])]))),128))])])):(n(),l("span",hi,[s("span",pi,_(D)+" - "+_(d.Name)+": ",1),d.Type=="String"?(n(),l("span",_i,_(d.Value),1)):h("",!0),y(r,{valueToCopy:d.Value},null,8,["valueToCopy"])]))]))),128))])}var fi=F(di,[["render",yi],["__scopeId","data-v-23269d9e"]]);const mi={props:["instanceId"],emits:["deletedInstance"],data(){return{tags:{},headers:{},loaded:!1}},computed:{},async mounted(){this.tags=(await b.getInstanceTags(this.instanceId)).data,this.headers=(await b.getInstanceHeader(this.instanceId)).data,this.loaded=!0},components:{ResourceButtonGroup:z,TagsTree:fi},methods:{onDeletedInstance(){this.$emit("deletedInstance",this.instanceId)}}},bi={key:0,class:"table table-responsive table-sm instance-details-table"},gi={width:"80%",class:"cut-text"},Si={width:"20%",class:"instance-button-group"};function Di(e,t,i,u,o,a){const c=S("TagsTree"),r=S("ResourceButtonGroup");return o.loaded?(n(),l("table",bi,[s("tr",null,[s("td",gi,[y(c,{tags:o.tags},null,8,["tags"])]),s("td",Si,[y(r,{resourceOrthancId:this.instanceId,resourceLevel:"instance",onDeletedResource:a.onDeletedInstance},null,8,["resourceOrthancId","onDeletedResource"])])])])):h("",!0)}var vi=F(mi,[["render",Di],["__scopeId","data-v-5570a3e0"]]);const Ii={props:["instanceId","instanceInfo"],emits:["deletedInstance"],data(){return{loaded:!1,expanded:!1,collapseElement:null}},mounted(){this.$refs["instance-collapsible-details"].addEventListener("show.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!0)}),this.$refs["instance-collapsible-details"].addEventListener("hide.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!1)});var e=this.$refs["instance-collapsible-details"];this.collapseElement=new E.Collapse(e,{toggle:!1});for(const[t,i]of Object.entries(this.$route.query))t==="expand"&&i==="instance"&&this.collapseElement.show()},methods:{onDeletedInstance(e){this.$emit("deletedInstance",e)}},computed:{},components:{InstanceDetails:vi}},wi=e=>(O("data-v-54cee9aa"),e=e(),N(),e),Fi=wi(()=>s("td",null,null,-1)),Mi=["data-bs-target"],Pi=["data-bs-target"],$i=["data-bs-target"],xi=["id"],ki={colspan:"100"};function Ci(e,t,i,u,o,a){const c=S("InstanceDetails");return n(),l("tbody",null,[s("tr",{class:g({"instance-row-collapsed":!o.expanded,"instance-row-expanded":o.expanded})},[Fi,s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#instance-details-"+this.instanceId},_(i.instanceInfo.MainDicomTags.InstanceNumber),9,Mi),s("td",{class:"cut-text","data-bs-toggle":"collapse","data-bs-target":"#instance-details-"+this.instanceId},_(i.instanceInfo.MainDicomTags.SOPInstanceUID),9,Pi),s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#instance-details-"+this.instanceId},_(i.instanceInfo.MainDicomTags.NumberOfFrames),9,$i)],2),s("tr",{class:g(["collapse",{"instance-details-collapsed":!o.expanded,"instance-details-expanded":o.expanded}]),id:"instance-details-"+this.instanceId,ref:"instance-collapsible-details"},[s("td",ki,[this.expanded?(n(),U(c,{key:0,instanceId:this.instanceId,onDeletedInstance:a.onDeletedInstance},null,8,["instanceId","onDeletedInstance"])):h("",!0)])],10,xi)])}var Oi=F(Ii,[["render",Ci],["__scopeId","data-v-54cee9aa"]]);const Ni={props:["seriesId"],emits:["deletedInstance"],data(){return{loaded:!1,instancesInfo:{}}},computed:{sortedInstancesIds(){if(this.loaded){let e=Object.keys(this.instancesInfo);return e.sort((t,i)=>parseInt(this.instancesInfo[t].IndexInSeries)>parseInt(this.instancesInfo[i].IndexInSeries)?1:-1),e}else return[]}},async mounted(){const e=await b.getSeriesInstances(this.seriesId);for(const t of e.data)this.instancesInfo[t.ID]=t;this.loaded=!0},methods:{onDeletedInstance(e){delete this.instancesInfo[e],this.$emit("deletedInstance",e)}},components:{InstanceItem:Oi}},Ui={class:"table table-responsive table-sm instance-table"},Ri=s("thead",null,[s("th",{width:"2%",scope:"col",class:"instance-table-header"}),s("th",{width:"7%",scope:"col",class:"instance-table-header cut-text","data-bs-toggle":"tooltip",title:"Instance Number"},"Instance Number"),s("th",{width:"40%",scope:"col",class:"instance-table-header cut-text","data-bs-toggle":"tooltip",title:"SOP Instance UID"},"SOP Instance UID"),s("th",{width:"5%",scope:"col",class:"series-table-header cut-text text-center","data-bs-toggle":"tooltip",title:"Number of Frames"},"# frames")],-1);function Ti(e,t,i,u,o,a){const c=S("InstanceItem");return n(),l("table",Ui,[Ri,(n(!0),l(I,null,w(a.sortedInstancesIds,r=>(n(),U(c,{key:r,instanceId:r,instanceInfo:o.instancesInfo[r],onDeletedInstance:a.onDeletedInstance},null,8,["instanceId","instanceInfo","onDeletedInstance"]))),128))])}var Li=F(Ni,[["render",Ti]]);const Ai={props:["title","value","truncate","copy"],setup(){return{}},data(){return{}},mounted(){},methods:{},computed:{},components:{CopyToClipboardButton:ie}},Ei={class:"d-flex"},Bi=p(": "),Vi={class:"details"};function ji(e,t,i,u,o,a){const c=S("CopyToClipboardButton");return n(),l("li",Ei,[s("span",{class:g(["details-label",{"d-inline-block text-truncate":this.truncate}])},[K(e.$slots,"default"),Bi],2),s("span",Vi,_(i.value),1),!this.copy&&this.value&&this.value.length>0?(n(),U(c,{key:0,valueToCopy:this.value},null,8,["valueToCopy"])):h("",!0)])}var H=F(Ai,[["render",ji]]);const qi={props:["seriesId","seriesMainDicomTags","instancesIds"],emits:["deletedSeries"],setup(){},data(){return{}},computed:{},components:{ResourceButtonGroup:z,InstanceList:Li,ResourceDetailText:H},methods:{onDeletedInstance(e){const t=this.instancesIds.indexOf(e);t>=0&&(this.instancesIds.splice(t,1),this.instancesIds.length==0&&this.$emit("deletedSeries",this.seriesId))},onDeletedSeries(){this.$emit("deletedSeries",this.seriesId)}}},Wi={class:"table table-responsive table-sm series-details-table"},Ji={width:"70%",class:"cut-text"},zi=p("Series Date"),Hi=p("Series Time"),Gi=p("Series Description"),Qi=p("Series Number"),Yi=p("Body Part Examined"),Ki=p("Protocol Name"),Zi=p("Series Instance UID"),Xi=p("Series Date"),eo={width:"30%",class:"series-button-group"},to={colspan:"100"};function so(e,t,i,u,o,a){const c=S("ResourceDetailText"),r=S("ResourceButtonGroup"),d=S("InstanceList");return n(),l("table",Wi,[s("tr",null,[s("td",Ji,[s("ul",null,[y(c,{value:i.seriesMainDicomTags.SeriesDate},{default:f(()=>[zi]),_:1},8,["value"]),y(c,{value:i.seriesMainDicomTags.SeriesTime},{default:f(()=>[Hi]),_:1},8,["value"]),y(c,{value:i.seriesMainDicomTags.SeriesDescription,truncate:!0},{default:f(()=>[Gi]),_:1},8,["value"]),y(c,{value:i.seriesMainDicomTags.SeriesNumber},{default:f(()=>[Qi]),_:1},8,["value"]),y(c,{value:i.seriesMainDicomTags.BodyPartExamined},{default:f(()=>[Yi]),_:1},8,["value"]),y(c,{value:i.seriesMainDicomTags.ProtocolName},{default:f(()=>[Ki]),_:1},8,["value"]),y(c,{value:i.seriesMainDicomTags.SeriesInstanceUID,truncate:!0},{default:f(()=>[Zi]),_:1},8,["value"]),y(c,{value:i.seriesMainDicomTags.SeriesDate},{default:f(()=>[Xi]),_:1},8,["value"])])]),s("td",eo,[y(r,{resourceOrthancId:this.seriesId,resourceLevel:"series",resourceDicomUid:this.seriesMainDicomTags.SeriesInstanceUID,customClass:"instance-button-group",onDeletedResource:a.onDeletedSeries},null,8,["resourceOrthancId","resourceDicomUid","onDeletedResource"])])]),s("tr",null,[s("td",to,[y(d,{seriesId:this.seriesId,seriesMainDicomTags:this.seriesMainDicomTags,instancesIds:this.instancesIds,onDeletedInstance:a.onDeletedInstance},null,8,["seriesId","seriesMainDicomTags","instancesIds","onDeletedInstance"])])])])}var io=F(qi,[["render",so],["__scopeId","data-v-3f1d23e2"]]);const oo={props:["seriesId","seriesInfo"],emits:["deletedSeries"],data(){return{loaded:!1,expanded:!1,collapseElement:null}},mounted(){this.$refs["series-collapsible-details"].addEventListener("show.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!0)}),this.$refs["series-collapsible-details"].addEventListener("hide.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!1)});var e=this.$refs["series-collapsible-details"];this.collapseElement=new E.Collapse(e,{toggle:!1});for(const[t,i]of Object.entries(this.$route.query))t==="expand"&&(i==="series"||i==="instance")&&this.collapseElement.show()},methods:{onDeletedSeries(){this.$emit("deletedSeries",this.seriesId)}},computed:{},components:{SeriesDetails:io}},ao=e=>(O("data-v-4a25c226"),e=e(),N(),e),no=ao(()=>s("td",null,null,-1)),lo=["data-bs-target"],ro=["data-bs-target"],uo=["title"],co=["data-bs-target"],ho=["data-bs-target"],po=["id"],_o={colspan:"100"};function yo(e,t,i,u,o,a){const c=S("SeriesDetails");return n(),l("tbody",null,[s("tr",{class:g({"series-row-collapsed":!o.expanded,"series-row-expanded":o.expanded})},[no,s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#series-details-"+this.seriesId},_(i.seriesInfo.MainDicomTags.SeriesNumber),9,lo),s("td",{class:"cut-text","data-bs-toggle":"collapse","data-bs-target":"#series-details-"+this.seriesId},[s("span",{"data-bs-toggle":"tooltip",title:i.seriesInfo.MainDicomTags.SeriesDescription},_(i.seriesInfo.MainDicomTags.SeriesDescription),9,uo)],8,ro),s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#series-details-"+this.seriesId},_(i.seriesInfo.MainDicomTags.Modality),9,co),s("td",{class:"cut-text text-center","data-bs-toggle":"collapse","data-bs-target":"#series-details-"+this.seriesId},_(i.seriesInfo.Instances.length),9,ho)],2),s("tr",{class:g(["collapse",{"series-details-collapsed":!o.expanded,"series-details-expanded":o.expanded}]),id:"series-details-"+this.seriesId,ref:"series-collapsible-details"},[s("td",_o,[this.expanded?(n(),U(c,{key:0,seriesId:this.seriesId,instancesIds:this.seriesInfo.Instances,seriesMainDicomTags:this.seriesInfo.MainDicomTags,onDeletedSeries:a.onDeletedSeries},null,8,["seriesId","instancesIds","seriesMainDicomTags","onDeletedSeries"])):h("",!0)])],10,po)])}var oe=F(oo,[["render",yo],["__scopeId","data-v-4a25c226"]]);const fo={props:["studyId"],emits:["deletedStudy"],data(){return{seriesInfo:{}}},computed:{sortedSeriesIds(){let e=Object.keys(this.seriesInfo);return e.sort((t,i)=>parseInt(this.seriesInfo[t].MainDicomTags.SeriesNumber)>parseInt(this.seriesInfo[i].MainDicomTags.SeriesNumber)?1:-1),e}},methods:{onDeletedSeries(e){delete this.seriesInfo[e],Object.keys(this.seriesInfo).length==0&&this.$emit("deletedStudy",this.studyId)}},async mounted(){const e=await b.getStudySeries(this.studyId);for(const t of e.data)this.seriesInfo[t.ID]=t},components:{SeriesItem:oe}},mo={class:"table table-responsive table-sm series-table"},bo=s("thead",null,[s("th",{width:"2%",scope:"col",class:"series-table-header"}),s("th",{width:"7%",scope:"col",class:"series-table-header cut-text","data-bs-toggle":"tooltip",title:"Series Number"},"Series Number"),s("th",{width:"40%",scope:"col",class:"series-table-header cut-text","data-bs-toggle":"tooltip",title:"Series Description"},"Series Description"),s("th",{width:"11%",scope:"col",class:"series-table-header cut-text text-center","data-bs-toggle":"tooltip",title:"Modality"},"Modality"),s("th",{width:"5%",scope:"col",class:"series-table-header cut-text text-center","data-bs-toggle":"tooltip",title:"Number of Instances"},"# instances")],-1);function go(e,t,i,u,o,a){const c=S("SeriesItem");return n(),l("table",mo,[bo,(n(!0),l(I,null,w(a.sortedSeriesIds,r=>(n(),U(c,{key:r,seriesId:r,seriesInfo:o.seriesInfo[r],onDeletedSeries:a.onDeletedSeries},null,8,["seriesId","seriesInfo","onDeletedSeries"]))),128))])}var ae=F(fo,[["render",go]]);const So={props:["studyId","studyMainDicomTags","patientMainDicomTags"],setup(){},data(){return{}},computed:{},components:{SeriesItem:oe,SeriesList:ae,ResourceButtonGroup:z,ResourceDetailText:H},methods:{onDeletedStudy(){this.$emit("deletedStudy",this.studyId)}}},Do={class:"table table-responsive table-sm study-details-table"},vo={width:"40%",class:"cut-text"},Io=p("Study Date"),wo=p("Study Time"),Fo=p("Study Description"),Mo=p("Accession Number"),Po=p("Study ID"),$o=p("Study Instance UID"),xo=p("RequestingPhysician"),ko=p("ReferringPhysicianName"),Co=p("InstitutionName"),Oo={width:"40%",class:"cut-text"},No=p("Patient ID"),Uo=p("Patient Name"),Ro=p("Patient Birth Date"),To=p("Patient Sex"),Lo={width:"20%",class:"study-button-group"},Ao={colspan:"100"};function Eo(e,t,i,u,o,a){const c=S("ResourceDetailText"),r=S("ResourceButtonGroup"),d=S("SeriesList");return n(),l("table",Do,[s("tr",null,[s("td",vo,[s("ul",null,[y(c,{value:i.studyMainDicomTags.StudyDate},{default:f(()=>[Io]),_:1},8,["value"]),y(c,{value:i.studyMainDicomTags.StudyTime},{default:f(()=>[wo]),_:1},8,["value"]),y(c,{value:i.studyMainDicomTags.StudyDescription,truncate:!0},{default:f(()=>[Fo]),_:1},8,["value"]),y(c,{value:i.studyMainDicomTags.AccessionNumber},{default:f(()=>[Mo]),_:1},8,["value"]),y(c,{value:i.studyMainDicomTags.StudyID},{default:f(()=>[Po]),_:1},8,["value"]),y(c,{value:i.studyMainDicomTags.StudyInstanceUID,truncate:!0},{default:f(()=>[$o]),_:1},8,["value"]),y(c,{value:i.studyMainDicomTags.RequestingPhysician},{default:f(()=>[xo]),_:1},8,["value"]),y(c,{value:i.studyMainDicomTags.ReferringPhysicianName},{default:f(()=>[ko]),_:1},8,["value"]),y(c,{value:i.studyMainDicomTags.InstitutionName},{default:f(()=>[Co]),_:1},8,["value"])])]),s("td",Oo,[s("ul",null,[y(c,{value:i.patientMainDicomTags.PatientID},{default:f(()=>[No]),_:1},8,["value"]),y(c,{value:i.patientMainDicomTags.PatientName},{default:f(()=>[Uo]),_:1},8,["value"]),y(c,{value:i.patientMainDicomTags.PatientBirthDate},{default:f(()=>[Ro]),_:1},8,["value"]),y(c,{value:i.patientMainDicomTags.PatientSex},{default:f(()=>[To]),_:1},8,["value"])])]),s("td",Lo,[y(r,{resourceOrthancId:this.studyId,resourceLevel:"study",resourceDicomUid:this.studyMainDicomTags.StudyInstanceUID,onDeletedResource:a.onDeletedStudy},null,8,["resourceOrthancId","resourceDicomUid","onDeletedResource"])])]),s("tr",null,[s("td",Ao,[y(d,{studyId:this.studyId,onDeletedStudy:a.onDeletedStudy},null,8,["studyId","onDeletedStudy"])])])])}var Bo=F(So,[["render",Eo],["__scopeId","data-v-3c63cba7"]]);const Vo={props:["studyId","isSearchButtonEnabled"],emits:["deletedStudy"],data(){return{fields:{},loaded:!1,expanded:!1,collapseElement:null}},async mounted(){const e=this.studies.filter(i=>i.ID==this.studyId)[0];this.fields=e,this.loaded=!0,this.seriesIds=e.Series,this.$refs["study-collapsible-details"]||console.log("no refs: ",studyResponse),this.$refs["study-collapsible-details"].addEventListener("show.bs.collapse",i=>{i.target==i.currentTarget&&(this.expanded=!0)}),this.$refs["study-collapsible-details"].addEventListener("hide.bs.collapse",i=>{i.target==i.currentTarget&&(this.expanded=!1)});var t=this.$refs["study-collapsible-details"];this.collapseElement=new E.Collapse(t,{toggle:!1});for(const[i,u]of Object.entries(this.$route.query))i==="expand"&&(u==null||u==="study"||u==="series"||u==="instance")&&this.collapseElement.show()},methods:{onDeletedStudy(e){this.$emit("deletedStudy",this.studyId)}},computed:R($({},C({uiOptions:e=>e.configuration.uiOptions,studies:e=>e.studies.studies})),{modalitiesInStudyForDisplay(){return this.fields.RequestedTags.ModalitiesInStudy.split("\\").join(",")}}),components:{SeriesList:ae,StudyDetails:Bo}},jo=e=>(O("data-v-46e858cb"),e=e(),N(),e),qo=jo(()=>s("td",null,null,-1)),Wo={key:0},Jo=["data-bs-target"],zo=["title"],Ho=["title"],Go=["title"],Qo=["title"],Yo=["title"],Ko=["title"],Zo=["title"],Xo={key:7},ea=["id"],ta={key:0,colspan:"100"};function sa(e,t,i,u,o,a){const c=S("StudyDetails");return n(),l("tbody",null,[o.loaded?(n(),l("tr",{key:0,class:g({"study-row-collapsed":!o.expanded,"study-row-expanded":o.expanded})},[qo,i.isSearchButtonEnabled?(n(),l("td",Wo)):h("",!0),(n(!0),l(I,null,w(e.uiOptions.StudyListColumns,r=>(n(),l("td",{key:r,class:g(["cut-text",{"text-center":r in["modalities","seriesCount"]}]),"data-bs-toggle":"collapse","data-bs-target":"#study-details-"+this.studyId},[r=="StudyDate"?(n(),l("span",{key:0,"data-bs-toggle":"tooltip",title:o.fields.MainDicomTags.StudyDate},_(o.fields.MainDicomTags.StudyDate),9,zo)):h("",!0),r=="AccessionNumber"?(n(),l("span",{key:1,"data-bs-toggle":"tooltip",title:o.fields.MainDicomTags.AccessionNumber},_(o.fields.MainDicomTags.AccessionNumber),9,Ho)):h("",!0),r=="PatientID"?(n(),l("span",{key:2,"data-bs-toggle":"tooltip",title:o.fields.PatientMainDicomTags.PatientID},_(o.fields.PatientMainDicomTags.PatientID),9,Go)):h("",!0),r=="PatientName"?(n(),l("span",{key:3,"data-bs-toggle":"tooltip",title:o.fields.PatientMainDicomTags.PatientName},_(o.fields.PatientMainDicomTags.PatientName),9,Qo)):h("",!0),r=="PatientBirthDate"?(n(),l("span",{key:4,"data-bs-toggle":"tooltip",title:o.fields.PatientMainDicomTags.PatientBirthDate},_(o.fields.PatientMainDicomTags.PatientBirthDate),9,Yo)):h("",!0),r=="StudyDescription"?(n(),l("span",{key:5,"data-bs-toggle":"tooltip",title:o.fields.MainDicomTags.StudyDescription},_(o.fields.MainDicomTags.StudyDescription),9,Ko)):h("",!0),r=="modalities"?(n(),l("span",{key:6,"data-bs-toggle":"tooltip",title:a.modalitiesInStudyForDisplay},_(a.modalitiesInStudyForDisplay),9,Zo)):h("",!0),r=="seriesCount"?(n(),l("span",Xo,_(o.fields.Series.length),1)):h("",!0)],10,Jo))),128))],2)):h("",!0),M(s("tr",{class:g(["collapse",{"study-details-collapsed":!o.expanded,"study-details-expanded":o.expanded}]),id:"study-details-"+this.studyId,ref:"study-collapsible-details"},[o.loaded&&o.expanded?(n(),l("td",ta,[y(c,{studyId:this.studyId,studyMainDicomTags:this.fields.MainDicomTags,patientMainDicomTags:this.fields.PatientMainDicomTags,onDeletedStudy:a.onDeletedStudy},null,8,["studyId","studyMainDicomTags","patientMainDicomTags","onDeletedStudy"])])):h("",!0)],10,ea),[[W,o.loaded]])])}var ia=F(Vo,[["render",sa],["__scopeId","data-v-46e858cb"]]);document._allowedFilters=["StudyDate","StudyTime","AccessionNumber","PatientID","PatientName","PatientBirthDate","StudyInstanceUID","StudyID","StudyDescription","ModalitiesInStudy"];document._studyColumns={StudyDate:{width:"7%",title:"Study Date",tooltip:"Study Date"},AccessionNumber:{width:"11%",title:"Accession Number",tooltip:"Accession Number"},PatientID:{width:"11%",title:"Patient ID",tooltip:"Patient ID"},PatientName:{width:"15%",title:"Patient Name",tooltip:"Patient Name"},PatientBirthDate:{width:"7%",title:"Patient Birth Date",tooltip:"Patient Birth Date"},StudyDescription:{width:"25%",title:"Description",tooltip:"Study Description"},modalities:{width:"6%",title:"Modalities",tooltip:"Modalities in Study",extraClasses:"text-center"},seriesCount:{width:"4%",title:"# series",tooltip:"Number of Series",extraClasses:"text-center"}};const oa={props:[],emits:["deletedStudy"],data(){return{filterStudyDate:"",filterAccessionNumber:"",filterPatientID:"",filterPatientName:"",filterPatientBirthDate:"",filterStudyDescription:"",filterModalities:{},allModalities:!0,noneModalities:!1,updatingFilterUi:!1,updatingRoute:!1,initializingModalityFilter:!1,searchTimerHandler:{},columns:document._studyColumns}},computed:R($($({},C({uiOptions:e=>e.configuration.uiOptions,isConfigurationLoaded:e=>e.configuration.loaded,studiesIds:e=>e.studies.studiesIds,isSearching:e=>e.studies.isSearching,statistics:e=>e.studies.statistics})),fe(["studies/isFilterEmpty"])),{notShowingAllResults(){return this.studiesIds.length>=this.statistics.CountStudies?!1:this.studiesIds.length==this.uiOptions.MaxStudiesDisplayed},isSearchAsYouTypeEnabled(){return this.uiOptions.StudyListSearchMode=="search-as-you-type"},isSearchButtonEnabled(){return this.uiOptions.StudyListSearchMode=="search-button"},showEmptyStudyListIfNoSearch(){return this.uiOptions.StudyListEmptyIfNoSearch},isStudyListEmpty(){return this.studiesIds.length==0}}),watch:{$route:async function(){this.updatingRoute||this.updateFilterFromRoute(this.$route.query),this.updatingRoute=!1},isConfigurationLoaded(e,t){this.initModalityFilter(),this.updateFilterFromRoute(this.$route.query)},filterModalities:{handler(e,t){!this.updatingFilterUi&&!this.initializingModalityFilter&&this.updateFilter("ModalitiesInStudy",this.getModalityFilter(),null)},deep:!0},filterStudyDate(e,t){this.updateFilter("StudyDate",e,t)},filterAccessionNumber(e,t){this.updateFilter("AccessionNumber",e,t)},filterPatientID(e,t){this.updateFilter("PatientID",e,t)},filterPatientName(e,t){this.updateFilter("PatientName",e,t)},filterPatientBirthDate(e,t){this.updateFilter("PatientBirthDate",e,t)},filterStudyDescription(e,t){this.updateFilter("StudyDescription",e,t)}},async created(){},async mounted(){},methods:{clearModalityFilter(){for(const e of this.uiOptions.ModalitiesFilter)this.filterModalities[e]=!0},initModalityFilter(){this.initializingModalityFilter=!0,this.filterModalities={};for(const e of this.uiOptions.ModalitiesFilter)this.filterModalities[e]=!0;this.initializingModalityFilter=!1},getModalityFilter(){if(this.filterModalities===void 0)return"";let e=!0,t=[];for(const[i,u]of Object.entries(this.filterModalities))e&=u,u&&t.push(i);return e?(this.allModalities=!0,this.noneModalities=!1,""):t.length==0?(this.allModalities=!1,this.noneModalities=!0,"NONE"):(this.allModalities=!1,this.noneModalities=!1,t.join("\\"))},updateFilter(e,t,i){if(!this.updatingFilterUi){if(i==null){this._updateFilter(e,t);return}!this.isSearchAsYouTypeEnabled||(t.length>=this.uiOptions.StudyListSearchAsYouTypeMinChars?(this.searchTimerHandler[e]&&clearTimeout(this.searchTimerHandler[e]),this.searchTimerHandler[e]=setTimeout(()=>{this._updateFilter(e,t)},this.uiOptions.StudyListSearchAsYouTypeDelay)):t.length<i.length&&i.length>=this.uiOptions.StudyListSearchAsYouTypeMinChars&&(this.searchTimerHandler[e]=setTimeout(()=>{this._updateFilter(e,"")},this.uiOptions.StudyListSearchAsYouTypeDelay)))}},clipFilter(e,t){return this.isFilterLongEnough(e,t)?t:""},getMinimalFilterLength(e){if(["AccessionNumber","PatientName","PatientID","StudyDescription"].indexOf(e)!=-1){if(this.isSearchAsYouTypeEnabled)return this.uiOptions.StudyListSearchAsYouTypeMinChars}else if(["PatientBirthDate","StudyDate"].indexOf(e)!=-1)return 8;return 0},isFilterLongEnough(e,t){return t.length>=this.getMinimalFilterLength(e)},getFilterClass(e){const t=this.getFilterValue(e);return t.length>0&&!this.isFilterLongEnough(e,t)?"is-invalid-filter":""},getFilterValue(e){if(e=="StudyDate")return this.filterStudyDate;if(e=="AccessionNumber")return this.filterAccessionNumber;if(e=="PatientID")return this.filterPatientID;if(e=="PatientName")return this.filterPatientName;if(e=="PatientBirthDate")return this.filterPatientBirthDate;if(e=="StudyDescription")return this.filterStudyDescription;e=="ModalitiesInStudy"&&console.error("getFilterValue ModalitiesInStudy")},_updateFilter(e,t){this.searchTimerHandler[e]=null,this.$store.dispatch("studies/updateFilter",{dicomTagName:e,value:t}),this.updateUrl()},async updateFilterFromRoute(e){if(this.updatingFilterUi=!0,e===void 0)await this.clearFiltersUi(),console.log("updateFilterFromRoute ... I think this code is not used anymore ...");else{await this.$store.dispatch("studies/clearFilterNoReload");var t={};for(const[i,u]of Object.entries(e))document._allowedFilters.indexOf(i)==-1?console.log("StudyList: Not a filter Key: ",i,u):(t[i]=u,await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:i,value:u}));await this.updateFilterForm(t),await this.$store.dispatch("studies/reloadFilteredStudies")}this.updatingFilterUi=!1},updateFilterForm(e){this.emptyFilterForm();for(const[t,i]of Object.entries(e))if(t=="StudyDate")this.filterStudyDate=i;else if(t=="AccessionNumber")this.filterAccessionNumber=i;else if(t=="PatientID")this.filterPatientID=i;else if(t=="PatientName")this.filterPatientName=i;else if(t=="PatientBirthDate")this.filterPatientBirthDate=i;else if(t=="StudyDescription")this.filterStudyDescription=i;else if(t=="ModalitiesInStudy"){const u=i.split("\\");if(u.length>0){let o=!0,a=!0;for(const c of this.uiOptions.ModalitiesFilter){const r=u.indexOf(c)!=-1;this.filterModalities[c]=r,o&=r,a&=!r}this.allModalities=o,this.noneModalities=a}}},emptyFilterForm(){this.filterStudyDate="",this.filterAccessionNumber="",this.filterPatientID="",this.filterPatientName="",this.filterPatientBirthDate="",this.filterStudyDescription="",this.clearModalityFilter()},async search(){this.isSearching?await this.$store.dispatch("studies/cancelSearch"):(await this.$store.dispatch("studies/clearFilterNoReload"),await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:"StudyDate",value:this.filterStudyDate}),await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:"AccessionNumber",value:this.filterAccessionNumber}),await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:"PatientID",value:this.filterPatientID}),await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:"PatientName",value:this.filterPatientName}),await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:"PatientBirthDate",value:this.filterPatientBirthDate}),await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:"StudyDescription",value:this.filterStudyDescription}),await this.$store.dispatch("studies/reloadFilteredStudies"),this.updateUrl())},async clearFilters(){await this.clearFiltersUi(),await this.$store.dispatch("studies/clearFilter")},async clearFiltersUi(){console.log("StudyList: clearFiltersUi IN"),this.updatingFilterUi=!0,this.emptyFilterForm(),this.updateUrl(),this.updatingFilterUi=!1,console.log("StudyList: clearFiltersUi OUT")},async toggleModalityFilter(e){const t=e.srcElement.getAttribute("data-value");let i=!0;t=="all"?i=!0:t=="none"&&(i=!1);for(const[u,o]of Object.entries(this.filterModalities))this.filterModalities[u]=i},modalityFilterClicked(e){e.stopPropagation()},closeModalityFilter(e){q("#dropdown-modalities-button").click(),e.preventDefault(),e.stopPropagation()},updateUrl(){let e=[];this.clipFilter("StudyDate",this.filterStudyDate)&&e.push("StudyDate="+this.filterStudyDate),this.clipFilter("AccessionNumber",this.filterAccessionNumber)&&e.push("AccessionNumber="+this.filterAccessionNumber),this.clipFilter("PatientID",this.filterPatientID)&&e.push("PatientID="+this.filterPatientID),this.clipFilter("PatientName",this.filterPatientName)&&e.push("PatientName="+this.filterPatientName),this.clipFilter("PatientBirthDate",this.filterPatientBirthDate)&&e.push("PatientBirthDate="+this.filterPatientBirthDate),this.clipFilter("StudyDescription",this.filterStudyDescription)&&e.push("StudyDescription="+this.filterStudyDescription),this.getModalityFilter()&&e.push("ModalitiesInStudy="+this.getModalityFilter());let t="";e.length>0&&(t="/filtered-studies?"+e.join("&")),this.updatingRoute=!0,this.$router.replace(t)},onDeletedStudy(e){this.$store.dispatch("studies/deleteStudy",{studyId:e})}},components:{StudyItem:ia}},aa={class:"table table-responsive table-sm study-table"},na=s("th",{width:"2%",scope:"col",class:"study-table-header"},null,-1),la={key:0,width:"5%",scope:"col",class:"study-table-header"},ra=["title","width"],da={scope:"col",class:"px-2"},ua=s("i",{class:"fa-regular fa-circle-xmark"},null,-1),ca=[ua],ha={key:0,scope:"col",class:"search-button"},pa={key:0,class:"fa-solid fa-magnifying-glass"},_a={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},ya={key:5,class:"dropdown"},fa=s("button",{type:"button",class:"btn btn-default btn-sm filter-button dropdown-toggle","data-bs-toggle":"dropdown",id:"dropdown-modalities-button","aria-expanded":"false"},[s("span",{class:"fa fa-list"}),p("\xA0"),s("span",{class:"caret"})],-1),ma={class:"dropdown-item"},ba=p("\xA0All"),ga={class:"dropdown-item"},Sa=p("\xA0None"),Da=s("li",null,[s("hr",{class:"dropdown-divider"})],-1),va={class:"dropdown-item"},Ia=["data-value","onUpdate:modelValue"],wa={key:0,class:"alert alert-danger bottom-fixed-alert",role:"alert"},Fa=s("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),Ma=p(" Not showing all results. You should refine your search criteria ! "),Pa=[Fa,Ma],$a={key:1,class:"alert alert-warning bottom-fixed-alert",role:"alert"},xa=s("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),ka=p(" Enter a search criteria to show results ! "),Ca=[xa,ka],Oa={key:2,class:"alert alert-warning bottom-fixed-alert",role:"alert"},Na=s("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),Ua=p(" No result found ! "),Ra=[Na,Ua],Ta={key:3,class:"alert alert-secondary bottom-fixed-alert",role:"alert"},La={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},Aa=p(" Searching ! ");function Ea(e,t,i,u,o,a){const c=S("StudyItem");return n(),l("div",null,[s("table",aa,[s("thead",null,[na,a.isSearchButtonEnabled?(n(),l("th",la)):h("",!0),(n(!0),l(I,null,w(e.uiOptions.StudyListColumns,r=>(n(),l("th",{key:r,"data-bs-toggle":"tooltip",title:o.columns[r].tooltip,width:o.columns[r].width,class:g("study-table-header cut-text "+o.columns[r].extraClasses)},_(o.columns[r].title),11,ra))),128))]),s("thead",{class:"study-filter",onKeyup:t[14]||(t[14]=X((...r)=>a.search&&a.search(...r),["enter"]))},[s("th",da,[s("button",{onClick:t[0]||(t[0]=(...r)=>a.clearFilters&&a.clearFilters(...r)),type:"button",class:"form-control study-list-filter btn filter-button","data-bs-toggle":"tooltip",title:"Clear filter"},ca)]),a.isSearchButtonEnabled?(n(),l("th",ha,[s("button",{onClick:t[1]||(t[1]=(...r)=>a.search&&a.search(...r)),type:"submit",class:g(["form-control study-list-filter btn filter-button btn-secondary",{"is-searching":e.isSearching,"is-not-searching":!e.isSearching}]),"data-bs-toggle":"tooltip",title:"Search"},[e.isSearching?h("",!0):(n(),l("i",pa)),e.isSearching?(n(),l("span",_a)):h("",!0)],2)])):h("",!0),(n(!0),l(I,null,w(e.uiOptions.StudyListColumns,r=>(n(),l("th",{key:r},[r=="StudyDate"?M((n(),l("input",{key:0,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("StudyDate")]),"onUpdate:modelValue":t[2]||(t[2]=d=>o.filterStudyDate=d),placeholder:"20220130"},null,2)),[[k,o.filterStudyDate]]):h("",!0),r=="AccessionNumber"?M((n(),l("input",{key:1,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("AccessionNumber")]),"onUpdate:modelValue":t[3]||(t[3]=d=>o.filterAccessionNumber=d),placeholder:"1234"},null,2)),[[k,o.filterAccessionNumber]]):h("",!0),r=="PatientID"?M((n(),l("input",{key:2,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("PatientID")]),"onUpdate:modelValue":t[4]||(t[4]=d=>o.filterPatientID=d),placeholder:"1234"},null,2)),[[k,o.filterPatientID]]):h("",!0),r=="PatientName"?M((n(),l("input",{key:3,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("PatientName")]),"onUpdate:modelValue":t[5]||(t[5]=d=>o.filterPatientName=d),placeholder:"John^Doe"},null,2)),[[k,o.filterPatientName]]):h("",!0),r=="PatientBirthDate"?M((n(),l("input",{key:4,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("PatientBirthDate")]),"onUpdate:modelValue":t[6]||(t[6]=d=>o.filterPatientBirthDate=d),placeholder:"19740815"},null,2)),[[k,o.filterPatientBirthDate]]):h("",!0),r=="modalities"?(n(),l("div",ya,[fa,s("ul",{class:"dropdown-menu","aria-labelledby":"dropdown-modalities-button",onClick:t[12]||(t[12]=(...d)=>a.modalityFilterClicked&&a.modalityFilterClicked(...d)),id:"modality-filter-dropdown"},[s("li",null,[s("label",ma,[M(s("input",{type:"checkbox","data-value":"all",onClick:t[7]||(t[7]=(...d)=>a.toggleModalityFilter&&a.toggleModalityFilter(...d)),"onUpdate:modelValue":t[8]||(t[8]=d=>o.allModalities=d)},null,512),[[T,o.allModalities]]),ba])]),s("li",null,[s("label",ga,[M(s("input",{type:"checkbox","data-value":"none",onClick:t[9]||(t[9]=(...d)=>a.toggleModalityFilter&&a.toggleModalityFilter(...d)),"onUpdate:modelValue":t[10]||(t[10]=d=>o.noneModalities=d)},null,512),[[T,o.noneModalities]]),Sa])]),Da,(n(!0),l(I,null,w(e.uiOptions.ModalitiesFilter,d=>(n(),l("li",{key:d},[s("label",va,[M(s("input",{type:"checkbox","data-value":d,"onUpdate:modelValue":D=>o.filterModalities[d]=D},null,8,Ia),[[T,o.filterModalities[d]]]),p("\xA0"+_(d),1)])]))),128)),s("li",null,[s("button",{class:"btn btn-primary mx-5",onClick:t[11]||(t[11]=(...d)=>a.closeModalityFilter&&a.closeModalityFilter(...d)),"data-bs-toggle":"dropdown"},"Close")])])])):h("",!0),r=="StudyDescription"?M((n(),l("input",{key:6,type:"text",class:"form-control study-list-filter","onUpdate:modelValue":t[13]||(t[13]=d=>o.filterStudyDescription=d),placeholder:"Chest"},null,512)),[[k,o.filterStudyDescription]]):h("",!0)]))),128))],32),(n(!0),l(I,null,w(e.studiesIds,r=>(n(),U(c,{key:r,studyId:r,isSearchButtonEnabled:a.isSearchButtonEnabled,onDeletedStudy:a.onDeletedStudy},null,8,["studyId","isSearchButtonEnabled","onDeletedStudy"]))),128))]),!e.isSearching&&a.notShowingAllResults?(n(),l("div",wa,Pa)):!e.isSearching&&a.showEmptyStudyListIfNoSearch&&this["studies/isFilterEmpty"]?(n(),l("div",$a,Ca)):!e.isSearching&&a.isStudyListEmpty?(n(),l("div",Oa,Ra)):e.isSearching?(n(),l("div",Ta,[e.isSearching?(n(),l("span",La)):h("",!0),Aa])):h("",!0)])}var ne=F(oa,[["render",Ea]]);const Ba={props:["studyFields","id","remoteMode","remoteSource"],setup(){},data(){return{}},computed:$({},C({system:e=>e.configuration.system})),components:{ResourceDetailText:H},methods:{async retrieve(){if(this.remoteMode=="dicom"){const e={StudyInstanceUID:this.studyFields.StudyInstanceUID,PatientID:this.studyFields.PatientID},t=await b.remoteDicomRetrieveStudy(this.remoteSource,e,this.system.DicomAet,"Study");this.$store.dispatch("jobs/addJob",{jobId:t,name:"Retrieve Study from ("+this.remoteSource+")"})}}}},Va=e=>(O("data-v-682b1740"),e=e(),N(),e),ja={class:"table table-responsive table-sm study-details-table"},qa={width:"40%",class:"cut-text"},Wa=p("Study Date"),Ja=p("Study Time"),za=p("Study Description"),Ha=p("Accession Number"),Ga=p("Study ID"),Qa=p("Study Instance UID"),Ya=p("RequestingPhysician"),Ka=p("ReferringPhysicianName"),Za=p("InstitutionName"),Xa={width:"40%",class:"cut-text"},en=p("Patient ID"),tn=p("Patient Name"),sn=p("Patient Birth Date"),on=p("Patient Sex"),an={width:"20%",class:"study-button-group"},nn={class:"d-grid d-lg-block gap-2"},ln=Va(()=>s("i",{class:"bi bi-box-arrow-in-down"},null,-1)),rn=[ln];function dn(e,t,i,u,o,a){const c=S("ResourceDetailText");return n(),l("table",ja,[s("tr",null,[s("td",qa,[s("ul",null,[y(c,{value:i.studyFields.StudyDate},{default:f(()=>[Wa]),_:1},8,["value"]),y(c,{value:i.studyFields.StudyTime},{default:f(()=>[Ja]),_:1},8,["value"]),y(c,{value:i.studyFields.StudyDescription,truncate:!0},{default:f(()=>[za]),_:1},8,["value"]),y(c,{value:i.studyFields.AccessionNumber},{default:f(()=>[Ha]),_:1},8,["value"]),y(c,{value:i.studyFields.StudyID},{default:f(()=>[Ga]),_:1},8,["value"]),y(c,{value:i.studyFields.StudyInstanceUID,truncate:!0},{default:f(()=>[Qa]),_:1},8,["value"]),y(c,{value:i.studyFields.RequestingPhysician},{default:f(()=>[Ya]),_:1},8,["value"]),y(c,{value:i.studyFields.ReferringPhysicianName},{default:f(()=>[Ka]),_:1},8,["value"]),y(c,{value:i.studyFields.InstitutionName},{default:f(()=>[Za]),_:1},8,["value"])])]),s("td",Xa,[s("ul",null,[y(c,{value:i.studyFields.PatientID},{default:f(()=>[en]),_:1},8,["value"]),y(c,{value:i.studyFields.PatientName},{default:f(()=>[tn]),_:1},8,["value"]),y(c,{value:i.studyFields.PatientBirthDate},{default:f(()=>[sn]),_:1},8,["value"]),y(c,{value:i.studyFields.PatientSex},{default:f(()=>[on]),_:1},8,["value"])])]),s("td",an,[s("div",nn,[s("a",{class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"tooltip",title:"Retrieve",onClick:t[0]||(t[0]=r=>a.retrieve())},rn)])])])])}var un=F(Ba,[["render",dn],["__scopeId","data-v-682b1740"]]);const cn={props:["studyFields","id","remoteMode","remoteSource"],emits:[],data(){return{loaded:!1,expanded:!1,collapseElement:null}},async mounted(){this.loaded=!0,this.$refs["study-collapsible-details"]||console.log("no refs: ",studyResponse),this.$refs["study-collapsible-details"].addEventListener("show.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!0)}),this.$refs["study-collapsible-details"].addEventListener("hide.bs.collapse",t=>{t.target==t.currentTarget&&(this.expanded=!1)});var e=this.$refs["study-collapsible-details"];this.collapseElement=new E.Collapse(e,{toggle:!1});for(const[t,i]of Object.entries(this.$route.query))t==="expand"&&(i==null||i==="study"||i==="series"||i==="instance")&&this.collapseElement.show()},methods:{},computed:R($({},C({uiOptions:e=>e.configuration.uiOptions})),{modalitiesInStudyForDisplay(){return this.studyFields.ModalitiesInStudy.split("\\").join(",")}}),components:{RemoteStudyDetails:un}},le=e=>(O("data-v-2a44b874"),e=e(),N(),e),hn=le(()=>s("td",null,null,-1)),pn=le(()=>s("td",null,null,-1)),_n=["data-bs-target"],yn=["title"],fn=["title"],mn=["title"],bn=["title"],gn=["title"],Sn=["title"],Dn=["title"],vn={key:7},In=["id"],wn={key:0,colspan:"100"};function Fn(e,t,i,u,o,a){const c=S("RemoteStudyDetails");return n(),l("tbody",null,[o.loaded?(n(),l("tr",{key:0,class:g({"study-row-collapsed":!o.expanded,"study-row-expanded":o.expanded})},[hn,pn,(n(!0),l(I,null,w(e.uiOptions.StudyListColumns,r=>(n(),l("td",{key:r,class:g(["cut-text",{"text-center":r in["modalities","seriesCount"]}]),"data-bs-toggle":"collapse","data-bs-target":"#study-details-"+this.id},[r=="StudyDate"?(n(),l("span",{key:0,"data-bs-toggle":"tooltip",title:i.studyFields.StudyDate},_(i.studyFields.StudyDate),9,yn)):h("",!0),r=="AccessionNumber"?(n(),l("span",{key:1,"data-bs-toggle":"tooltip",title:i.studyFields.AccessionNumber},_(i.studyFields.AccessionNumber),9,fn)):h("",!0),r=="PatientID"?(n(),l("span",{key:2,"data-bs-toggle":"tooltip",title:i.studyFields.PatientID},_(i.studyFields.PatientID),9,mn)):h("",!0),r=="PatientName"?(n(),l("span",{key:3,"data-bs-toggle":"tooltip",title:i.studyFields.PatientName},_(i.studyFields.PatientName),9,bn)):h("",!0),r=="PatientBirthDate"?(n(),l("span",{key:4,"data-bs-toggle":"tooltip",title:i.studyFields.PatientBirthDate},_(i.studyFields.PatientBirthDate),9,gn)):h("",!0),r=="StudyDescription"?(n(),l("span",{key:5,"data-bs-toggle":"tooltip",title:i.studyFields.StudyDescription},_(i.studyFields.StudyDescription),9,Sn)):h("",!0),r=="modalities"?(n(),l("span",{key:6,"data-bs-toggle":"tooltip",title:a.modalitiesInStudyForDisplay},_(a.modalitiesInStudyForDisplay),9,Dn)):h("",!0),r=="seriesCount"?(n(),l("span",vn,_(i.studyFields.NumberOfStudyRelatedSeries),1)):h("",!0)],10,_n))),128))],2)):h("",!0),M(s("tr",{class:g(["collapse",{"study-details-collapsed":!o.expanded,"study-details-expanded":o.expanded}]),id:"study-details-"+this.id,ref:"study-collapsible-details"},[o.loaded&&o.expanded?(n(),l("td",wn,[y(c,{studyFields:this.studyFields,id:this.id,remoteMode:this.remoteMode,remoteSource:this.remoteSource},null,8,["studyFields","id","remoteMode","remoteSource"])])):h("",!0)],10,In),[[W,o.loaded]])])}var Mn=F(cn,[["render",Fn],["__scopeId","data-v-2a44b874"]]);document._remoteStudyAllowedFilters=["StudyDate","StudyTime","AccessionNumber","PatientID","PatientName","PatientBirthDate","StudyInstanceUID","StudyID","StudyDescription","ModalitiesInStudy"];document._remoteStudyColumns={StudyDate:{width:"7%",title:"Study Date",tooltip:"Study Date"},AccessionNumber:{width:"11%",title:"Accession Number",tooltip:"Accession Number"},PatientID:{width:"11%",title:"Patient ID",tooltip:"Patient ID"},PatientName:{width:"15%",title:"Patient Name",tooltip:"Patient Name"},PatientBirthDate:{width:"7%",title:"Patient Birth Date",tooltip:"Patient Birth Date"},StudyDescription:{width:"25%",title:"Description",tooltip:"Study Description"},modalities:{width:"6%",title:"Modalities",tooltip:"Modalities in Study",extraClasses:"text-center"},seriesCount:{width:"4%",title:"# series",tooltip:"Number of Series",extraClasses:"text-center"}};const Pn={props:[],emits:[],data(){return{filterStudyDate:"",filterAccessionNumber:"",filterPatientID:"",filterPatientName:"",filterPatientBirthDate:"",filterStudyDescription:"",filterModalities:{},allModalities:!0,noneModalities:!1,updatingFilterUi:!1,updatingRoute:!1,initializingModalityFilter:!1,columns:document._remoteStudyColumns,remoteMode:null,remoteSource:null,studies:[],isSearching:!1}},computed:R($({},C({uiOptions:e=>e.configuration.uiOptions,isConfigurationLoaded:e=>e.configuration.loaded})),{isFilterEmpty(){return this.filterStudyDate.length==0&&this.filterAccessionNumber.length==0&&this.filterPatientID.length==0&&this.filterPatientName.length==0&&this.filterPatientBirthDate.length==0&&this.filterStudyDescription.length==0&&this.getModalityFilter().length==0},isStudyListEmpty(){return this.studies.length==0}}),watch:{$route:async function(){this.updatingRoute||this.updateFilterFromRoute(this.$route.query),this.updatingRoute=!1},isConfigurationLoaded(e,t){this.initModalityFilter(),this.updateFilterFromRoute(this.$route.query)},filterModalities:{handler(e,t){!this.updatingFilterUi&&!this.initializingModalityFilter&&this.updateFilter("ModalitiesInStudy",this.getModalityFilter(),null)},deep:!0},filterStudyDate(e,t){this.updateFilter("StudyDate",e,t)},filterAccessionNumber(e,t){this.updateFilter("AccessionNumber",e,t)},filterPatientID(e,t){this.updateFilter("PatientID",e,t)},filterPatientName(e,t){this.updateFilter("PatientName",e,t)},filterPatientBirthDate(e,t){this.updateFilter("PatientBirthDate",e,t)},filterStudyDescription(e,t){this.updateFilter("StudyDescription",e,t)}},async created(){},async mounted(){this.updateFilterFromRoute(this.$route.query)},methods:{clearModalityFilter(){for(const e of this.uiOptions.ModalitiesFilter)this.filterModalities[e]=!0},initModalityFilter(){this.initializingModalityFilter=!0,this.filterModalities={};for(const e of this.uiOptions.ModalitiesFilter)this.filterModalities[e]=!0;this.initializingModalityFilter=!1},getModalityFilter(){if(this.filterModalities===void 0)return"";let e=!0,t=[];for(const[i,u]of Object.entries(this.filterModalities))e&=u,u&&t.push(i);return e?(this.allModalities=!0,this.noneModalities=!1,""):t.length==0?(this.allModalities=!1,this.noneModalities=!0,"NONE"):(this.allModalities=!1,this.noneModalities=!1,t.join("\\"))},updateFilter(e,t,i){if(!this.updatingFilterUi&&i==null){this._updateFilter(e,t);return}},clipFilter(e,t){return this.isFilterLongEnough(e,t)?t:""},getMinimalFilterLength(e){return["AccessionNumber","PatientName","PatientID","StudyDescription"].indexOf(e)!=-1?2:["PatientBirthDate","StudyDate"].indexOf(e)!=-1?8:0},isFilterLongEnough(e,t){return t.length>=this.getMinimalFilterLength(e)},getFilterClass(e){const t=this.getFilterValue(e);return t.length>0&&!this.isFilterLongEnough(e,t)?"is-invalid-filter":""},getFilterValue(e){if(e=="StudyDate")return this.filterStudyDate;if(e=="AccessionNumber")return this.filterAccessionNumber;if(e=="PatientID")return this.filterPatientID;if(e=="PatientName")return this.filterPatientName;if(e=="PatientBirthDate")return this.filterPatientBirthDate;if(e=="StudyDescription")return this.filterStudyDescription;e=="ModalitiesInStudy"&&console.error("getFilterValue ModalitiesInStudy")},_updateFilter(e,t){this.updateUrl()},async updateFilterFromRoute(e){if(this.remoteMode=this.$route.query.remoteMode,this.remoteSource=this.$route.query.remoteSource,this.updatingFilterUi=!0,e===void 0)await this.clearFiltersUi(),console.log("updateFilterFromRoute ... I think this code is not used anymore ...");else{var t={};for(const[i,u]of Object.entries(e))document._remoteStudyAllowedFilters.indexOf(i)==-1?console.log("StudyList: Not a filter Key: ",i,u):(t[i]=u,await this.$store.dispatch("studies/updateFilterNoReload",{dicomTagName:i,value:u}));await this.updateFilterForm(t)}this.updatingFilterUi=!1},updateFilterForm(e){this.emptyFilterForm();for(const[t,i]of Object.entries(e))if(t=="StudyDate")this.filterStudyDate=i;else if(t=="AccessionNumber")this.filterAccessionNumber=i;else if(t=="PatientID")this.filterPatientID=i;else if(t=="PatientName")this.filterPatientName=i;else if(t=="PatientBirthDate")this.filterPatientBirthDate=i;else if(t=="StudyDescription")this.filterStudyDescription=i;else if(t=="ModalitiesInStudy"){const u=i.split("\\");if(u.length>0){let o=!0,a=!0;for(const c of this.uiOptions.ModalitiesFilter){const r=u.indexOf(c)!=-1;this.filterModalities[c]=r,o&=r,a&=!r}this.allModalities=o,this.noneModalities=a}}},emptyFilterForm(){this.filterStudyDate="",this.filterAccessionNumber="",this.filterPatientID="",this.filterPatientName="",this.filterPatientBirthDate="",this.filterStudyDescription="",this.clearModalityFilter()},async search(){if(this.isSearching&&(b.cancelRemoteDicomFindStudies(),this.isSearching=!1),this.remoteMode=="dicom"){let e={StudyDate:"",StudyTime:"",StudyID:"",AccessionNumber:"",PatientID:"",PatientName:"",PatientBirthDate:"",PatientSex:"",StudyDescription:"",StudyInstanceUID:"",ModalitiesInStudy:"",NumberOfStudyRelatedSeries:"",RequestingPhysician:"",ReferringPhysicianName:"",InstitutionName:""};this.filterStudyDate.length>=8&&(e.StudyDate=this.filterStudyDate),this.filterAccessionNumber.length>=1&&(e.AccessionNumber="*"+this.filterAccessionNumber+"*"),this.filterPatientID.length>=1&&(e.PatientID="*"+this.filterPatientID+"*"),this.filterPatientName.length>=1&&(e.PatientName="*"+this.filterPatientName+"*"),this.filterPatientBirthDate.length>=8&&(e.PatientBirthDate=this.filterPatientBirthDate),this.filterStudyDescription.length>=1&&(e.StudyDescription="*"+this.filterStudyDescription+"*"),this.getModalityFilter().length>=1&&(e.ModalitiesInStudy=this.getModalityFilter());let t=b.remoteDicomFindStudies(this.remoteSource,e);this.isSearching=!0,t.then(i=>{console.log("received studies",i),this.studies=i,this.isSearching=!1})}this.updateUrl()},async clearFilters(){await this.clearFiltersUi(),await this.$store.dispatch("studies/clearFilter")},async clearFiltersUi(){console.log("StudyList: clearFiltersUi IN"),this.updatingFilterUi=!0,this.emptyFilterForm(),this.updateUrl(),this.updatingFilterUi=!1,console.log("StudyList: clearFiltersUi OUT")},async toggleModalityFilter(e){const t=e.srcElement.getAttribute("data-value");let i=!0;t=="all"?i=!0:t=="none"&&(i=!1);for(const[u,o]of Object.entries(this.filterModalities))this.filterModalities[u]=i},modalityFilterClicked(e){e.stopPropagation()},closeModalityFilter(e){q("#dropdown-modalities-button").click(),e.preventDefault(),e.stopPropagation()},updateUrl(){let e=[];this.clipFilter("StudyDate",this.filterStudyDate)&&e.push("StudyDate="+this.filterStudyDate),this.clipFilter("AccessionNumber",this.filterAccessionNumber)&&e.push("AccessionNumber="+this.filterAccessionNumber),this.clipFilter("PatientID",this.filterPatientID)&&e.push("PatientID="+this.filterPatientID),this.clipFilter("PatientName",this.filterPatientName)&&e.push("PatientName="+this.filterPatientName),this.clipFilter("PatientBirthDate",this.filterPatientBirthDate)&&e.push("PatientBirthDate="+this.filterPatientBirthDate),this.clipFilter("StudyDescription",this.filterStudyDescription)&&e.push("StudyDescription="+this.filterStudyDescription),this.getModalityFilter()&&e.push("ModalitiesInStudy="+this.getModalityFilter()),e.push("remoteMode="+this.remoteMode),e.push("remoteSource="+this.remoteSource);let t="";e.length>0&&(t="/filtered-remote-studies?"+e.join("&")),this.updatingRoute=!0,this.$router.replace(t)}},components:{RemoteStudyItem:Mn}},$n={class:"table table-responsive table-sm study-table"},xn=s("th",{width:"2%",scope:"col",class:"study-table-header"},null,-1),kn=s("th",{width:"5%",scope:"col",class:"study-table-header"},null,-1),Cn=["title","width"],On={scope:"col",class:"px-2"},Nn=s("i",{class:"fa-regular fa-circle-xmark"},null,-1),Un=[Nn],Rn={scope:"col",class:"search-button"},Tn={key:0,class:"fa-solid fa-magnifying-glass"},Ln={key:1,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},An={key:5,class:"dropdown"},En=s("button",{type:"button",class:"btn btn-default btn-sm filter-button dropdown-toggle","data-bs-toggle":"dropdown",id:"dropdown-modalities-button","aria-expanded":"false"},[s("span",{class:"fa fa-list"}),p("\xA0"),s("span",{class:"caret"})],-1),Bn={class:"dropdown-item"},Vn=p("\xA0All"),jn={class:"dropdown-item"},qn=p("\xA0None"),Wn=s("li",null,[s("hr",{class:"dropdown-divider"})],-1),Jn={class:"dropdown-item"},zn=["data-value","onUpdate:modelValue"],Hn={key:0,class:"alert alert-warning bottom-fixed-alert",role:"alert"},Gn=s("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),Qn=p(" Enter a search criteria to show results ! "),Yn=[Gn,Qn],Kn={key:1,class:"alert alert-warning bottom-fixed-alert",role:"alert"},Zn=s("i",{class:"bi bi-exclamation-triangle-fill"},null,-1),Xn=p(" No result found ! "),el=[Zn,Xn],tl={key:2,class:"alert alert-secondary bottom-fixed-alert",role:"alert"},sl={key:0,class:"spinner-border spinner-border-sm",role:"status","aria-hidden":"true"},il=p(" Searching ! ");function ol(e,t,i,u,o,a){const c=S("RemoteStudyItem");return n(),l("div",null,[s("table",$n,[s("p",null,_(this.remoteMode)+" "+_(this.remoteSource),1),s("thead",null,[xn,kn,(n(!0),l(I,null,w(e.uiOptions.StudyListColumns,r=>(n(),l("th",{key:r,"data-bs-toggle":"tooltip",title:o.columns[r].tooltip,width:o.columns[r].width,class:g("study-table-header cut-text "+o.columns[r].extraClasses)},_(o.columns[r].title),11,Cn))),128))]),s("thead",{class:"study-filter",onKeyup:t[14]||(t[14]=X((...r)=>a.search&&a.search(...r),["enter"]))},[s("th",On,[s("button",{onClick:t[0]||(t[0]=(...r)=>a.clearFilters&&a.clearFilters(...r)),type:"button",class:"form-control study-list-filter btn filter-button","data-bs-toggle":"tooltip",title:"Clear filter"},Un)]),s("th",Rn,[s("button",{onClick:t[1]||(t[1]=(...r)=>a.search&&a.search(...r)),type:"submit",class:g(["form-control study-list-filter btn filter-button btn-secondary",{"is-searching":o.isSearching,"is-not-searching":!o.isSearching}]),"data-bs-toggle":"tooltip",title:"Search"},[o.isSearching?h("",!0):(n(),l("i",Tn)),o.isSearching?(n(),l("span",Ln)):h("",!0)],2)]),(n(!0),l(I,null,w(e.uiOptions.StudyListColumns,r=>(n(),l("th",{key:r},[r=="StudyDate"?M((n(),l("input",{key:0,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("StudyDate")]),"onUpdate:modelValue":t[2]||(t[2]=d=>o.filterStudyDate=d),placeholder:"20220130"},null,2)),[[k,o.filterStudyDate]]):h("",!0),r=="AccessionNumber"?M((n(),l("input",{key:1,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("AccessionNumber")]),"onUpdate:modelValue":t[3]||(t[3]=d=>o.filterAccessionNumber=d),placeholder:"1234"},null,2)),[[k,o.filterAccessionNumber]]):h("",!0),r=="PatientID"?M((n(),l("input",{key:2,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("PatientID")]),"onUpdate:modelValue":t[4]||(t[4]=d=>o.filterPatientID=d),placeholder:"1234"},null,2)),[[k,o.filterPatientID]]):h("",!0),r=="PatientName"?M((n(),l("input",{key:3,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("PatientName")]),"onUpdate:modelValue":t[5]||(t[5]=d=>o.filterPatientName=d),placeholder:"John^Doe"},null,2)),[[k,o.filterPatientName]]):h("",!0),r=="PatientBirthDate"?M((n(),l("input",{key:4,type:"text",class:g(["form-control study-list-filter",a.getFilterClass("PatientBirthDate")]),"onUpdate:modelValue":t[6]||(t[6]=d=>o.filterPatientBirthDate=d),placeholder:"19740815"},null,2)),[[k,o.filterPatientBirthDate]]):h("",!0),r=="modalities"?(n(),l("div",An,[En,s("ul",{class:"dropdown-menu","aria-labelledby":"dropdown-modalities-button",onClick:t[12]||(t[12]=(...d)=>a.modalityFilterClicked&&a.modalityFilterClicked(...d)),id:"modality-filter-dropdown"},[s("li",null,[s("label",Bn,[M(s("input",{type:"checkbox","data-value":"all",onClick:t[7]||(t[7]=(...d)=>a.toggleModalityFilter&&a.toggleModalityFilter(...d)),"onUpdate:modelValue":t[8]||(t[8]=d=>o.allModalities=d)},null,512),[[T,o.allModalities]]),Vn])]),s("li",null,[s("label",jn,[M(s("input",{type:"checkbox","data-value":"none",onClick:t[9]||(t[9]=(...d)=>a.toggleModalityFilter&&a.toggleModalityFilter(...d)),"onUpdate:modelValue":t[10]||(t[10]=d=>o.noneModalities=d)},null,512),[[T,o.noneModalities]]),qn])]),Wn,(n(!0),l(I,null,w(e.uiOptions.ModalitiesFilter,d=>(n(),l("li",{key:d},[s("label",Jn,[M(s("input",{type:"checkbox","data-value":d,"onUpdate:modelValue":D=>o.filterModalities[d]=D},null,8,zn),[[T,o.filterModalities[d]]]),p("\xA0"+_(d),1)])]))),128)),s("li",null,[s("button",{class:"btn btn-primary mx-5",onClick:t[11]||(t[11]=(...d)=>a.closeModalityFilter&&a.closeModalityFilter(...d)),"data-bs-toggle":"dropdown"},"Close")])])])):h("",!0),r=="StudyDescription"?M((n(),l("input",{key:6,type:"text",class:"form-control study-list-filter","onUpdate:modelValue":t[13]||(t[13]=d=>o.filterStudyDescription=d),placeholder:"Chest"},null,512)),[[k,o.filterStudyDescription]]):h("",!0)]))),128))],32),(n(!0),l(I,null,w(o.studies,(r,d)=>(n(),U(c,{key:r.StudyInstanceUID,studyFields:r,id:d,remoteMode:this.remoteMode,remoteSource:this.remoteSource},null,8,["studyFields","id","remoteMode","remoteSource"]))),128))]),!o.isSearching&&a.isFilterEmpty?(n(),l("div",Hn,Yn)):!o.isSearching&&a.isStudyListEmpty?(n(),l("div",Kn,el)):o.isSearching?(n(),l("div",tl,[o.isSearching?(n(),l("span",sl)):h("",!0),il])):h("",!0)])}var al=F(Pn,[["render",ol]]);const nl={props:["report"],emits:["deletedUploadReport"],data(){return{}},mounted(){},computed:R($({},C({uiOptions:e=>e.configuration.uiOptions})),{pctSuccess(){return 100*this.report.successFilesCount/this.report.filesCount},pctSkipped(){return 100*this.report.skippedFilesCount/this.report.filesCount},pctFailed(){return 100*this.report.failedFilesCount/this.report.filesCount}}),methods:{close(e){this.$emit("deletedUploadReport",e)},getStudyLine(e,t,i){let u=[];for(let o of this.uiOptions.UploadReportTags)o in t&&t[o]&&t[o].length>0?u.push(t[o]):o in i&&i[o]&&i[o].length>0&&u.push(i[o]);return u.length==0&&u.push(e.slice(0,20)+"..."),u.slice(0,this.uiOptions.UploadReportMaxTags).join(" - ")}},components:{Modal:J}},B=e=>(O("data-v-5f0e708d"),e=e(),N(),e),ll={class:"card border-secondary job-card"},rl={class:"card-header jobs-header"},dl={class:"progress",style:{width:"90%"}},ul=["data-bs-target"],cl={class:"table table-sm"},hl=B(()=>s("thead",null,[s("tr",null,[s("th",{width:"50%"},"File"),s("th",{width:"50%"},"Error")])],-1)),pl={class:"text-right"},_l={class:"card-body text-secondary jobs-body"},yl={class:"card-text"},fl=B(()=>s("span",{class:"upload-details"},"Uploaded studies:",-1)),ml=B(()=>s("br",null,null,-1)),bl=B(()=>s("br",null,null,-1));function gl(e,t,i,u,o,a){const c=S("Modal"),r=S("router-link");return n(),l("div",ll,[s("div",rl,[p(" Upload "+_(i.report.filesCount)+" files ",1),s("button",{type:"button",class:"btn-close job-card-close","aria-label":"Close",onClick:t[0]||(t[0]=d=>a.close(i.report.id))}),s("div",dl,[s("div",{class:"progress-bar bg-success",role:"progressbar",style:L("width: "+this.pctSuccess+"%")},null,4),s("div",{class:"progress-bar bg-secondary",role:"progressbar",style:L("width: "+this.pctSkipped+"%")},null,4),s("div",{class:"progress-bar bg-danger",role:"progressbar",style:L("width: "+this.pctFailed+"%")},null,4)]),M(s("div",null,[s("button",{class:"btn btn-sm btn-secondary m-1",type:"button","data-bs-toggle":"modal","data-bs-target":"#upload-errors-modal-"+this.report.id},"show errors",8,ul),y(c,{id:"upload-errors-modal-"+this.report.id,headerText:"Upload error report",okText:"Close",onOk:t[1]||(t[1]=d=>a.close(d))},{modalBody:f(()=>[s("table",cl,[hl,s("tbody",null,[(n(!0),l(I,null,w(i.report.errorMessages,(d,D)=>(n(),l("tr",{key:d},[s("td",null,_(D),1),s("td",pl,_(d),1)]))),128))])])]),_:1},8,["id"])],512),[[W,Object.keys(i.report.errorMessages).length>0]])]),s("div",_l,[s("p",yl,[fl,ml,(n(!0),l(I,null,w(i.report.uploadedStudies,(d,D)=>(n(),l("span",{key:D},[y(r,{to:"/filtered-studies?StudyInstanceUID="+d.MainDicomTags.StudyInstanceUID+"&expand=study",class:"upload-details-study"},{default:f(()=>[p(_(this.getStudyLine(D,d.MainDicomTags,d.PatientMainDicomTags)),1)]),_:2},1032,["to"]),bl]))),128))])])])}var Sl=F(nl,[["render",gl],["__scopeId","data-v-5f0e708d"]]);async function Dl(e){let t=[],i=[];for(let u=0;u<e.length;u++)i.push(e[u].webkitGetAsEntry());for(;i.length>0;){let u=i.shift();if(u.isFile)t.push(u);else if(u.isDirectory){let o=u.createReader();i.push(...await wl(o))}}return t}async function vl(e){try{return await new Promise((t,i)=>e.file(t,i))}catch(t){console.log(t)}}async function Il(e){let t=await Dl(e),i=[];for(let u of t)i.push(await vl(u));return i}async function wl(e){let t=[],i=await re(e);for(;i.length>0;)t.push(...i),i=await re(e);return t}async function re(e){try{return await new Promise((t,i)=>{e.readEntries(t,i)})}catch(t){console.log(t)}}function Fl(e){return new Promise((t,i)=>{let u=new FileReader;u.onload=()=>{t(u.result)},u.onerror=i,u.readAsArrayBuffer(e)})}const Ml={props:[],data(){return{uppie:null,uploadCounter:0,lastUploadReports:{}}},mounted(){this.uppie=new me,this.uppie(document.querySelector("#filesUpload"),this.uppieUploadHandler),this.uppie(document.querySelector("#foldersUpload"),this.uppieUploadHandler)},methods:{onDrop(e){console.log("on drop",e),e.preventDefault(),Il(e.dataTransfer.items).then(t=>{this.uploadFiles(t)})},onDragOver(e){e.preventDefault()},onDeletedUploadReport(e){delete this.lastUploadReports[e]},async uploadedFile(e,t){let i=t.ParentStudy;if(!this.lastUploadReports[e].uploadedStudiesIds.has(i)){this.lastUploadReports[e].uploadedStudiesIds.add(i);const u=await b.getStudy(i);this.lastUploadReports[e].uploadedStudies[i]=u.data,this.$store.dispatch("studies/addStudy",{study:u.data,studyId:i})}},async uploadFiles(e){let t=this.uploadCounter++;this.lastUploadReports[t]={id:t,filesCount:e.length,successFilesCount:0,failedFilesCount:0,skippedFilesCount:0,uploadedStudiesIds:new Set,uploadedStudies:{},errorMessages:{}};for(let i of e){let u=i.webkitRelativePath||i.name;if(i.name=="DICOMDIR"){console.log("upload: skipping DICOMDIR file"),this.lastUploadReports[t].skippedFilesCount++,this.lastUploadReports[t].errorMessages[u]="skipped";continue}const o=await Fl(i);try{const a=await b.uploadFile(o);if(Array.isArray(a.data))if(a.data.length>0){this.lastUploadReports[t].successFilesCount++;for(let c of a.data)this.uploadedFile(t,c)}else this.lastUploadReports[t].failedFilesCount++,this.lastUploadReports[t].errorMessages[u]="no valid DICOM files found in zip";else this.lastUploadReports[t].successFilesCount++,this.uploadedFile(t,a.data)}catch(a){console.log(a);let c="error "+a.response.status;a.response.status>=400&&a.response.status<500&&(c=a.response.data.Message),this.lastUploadReports[t].failedFilesCount++,this.lastUploadReports[t].errorMessages[u]=c}}},async uppieUploadHandler(e,t,i){this.uploadFiles(e.target.files)}},components:{UploadReport:Sl}},G=e=>(O("data-v-f2c0f302"),e=e(),N(),e),Pl=G(()=>s("div",{class:"mb-3"},"Drop files here or",-1)),$l=G(()=>s("div",{class:"mb-3"},[s("label",{class:"btn btn-primary btn-file"},[p(" Select folder "),s("input",{type:"file",style:{display:"none"},id:"foldersUpload",required:"",multiple:"",directory:"",webkitdirectory:"",allowdirs:""})])],-1)),xl=G(()=>s("div",{class:"mb-3"},[s("label",{class:"btn btn-primary btn-file"},[p(" Select files "),s("input",{type:"file",style:{display:"none"},id:"filesUpload",required:"",multiple:""})])],-1)),kl=[Pl,$l,xl],Cl={class:"upload-report-list"};function Ol(e,t,i,u,o,a){const c=S("UploadReport");return n(),l("div",null,[s("div",{class:"upload-handler-drop-zone",onDrop:t[0]||(t[0]=(...r)=>this.onDrop&&this.onDrop(...r)),onDragover:t[1]||(t[1]=(...r)=>this.onDragOver&&this.onDragOver(...r))},kl,32),s("div",Cl,[(n(!0),l(I,null,w(o.lastUploadReports,(r,d)=>(n(),U(c,{report:r,key:d,onDeletedUploadReport:a.onDeletedUploadReport},null,8,["report","onDeletedUploadReport"]))),128))])])}var Nl=F(Ml,[["render",Ol],["__scopeId","data-v-f2c0f302"]]);const Ul={props:["job"],emits:["deletedJob"],data(){return{isComplete:!1,isRunning:!1,isSuccess:!1,pctComplete:0,pctFailed:0,pctRemaining:100,refreshTimeout:200}},mounted(){},computed:$({},C({uiOptions:e=>e.configuration.uiOptions})),methods:{close(e){this.$emit("deletedJob",e)},async refresh(e){const t=await b.getJobStatus(e);this.isComplete=t.State=="Success"||t.State=="Failure",this.isRunning=t.State=="Running",this.isSuccess=t.State=="Success",this.isComplete?(this.pctRemaining=0,this.isSuccess?(this.pctComplete=100,this.pctFailed=0):(this.pctComplete=0,this.pctFailed=100)):(this.pctFailed=0,this.pctComplete=t.Progress,this.pctRemaining=100-this.pctComplete),this.isComplete||(this.refreshTimeout=Math.min(this.refreshTimeout+200,2e3),setTimeout(this.refresh,this.refreshTimeout,[e]))}},async mounted(){this.refresh(this.job.id)},components:{Modal:J}},Rl=e=>(O("data-v-1c704475"),e=e(),N(),e),Tl={class:"card border-secondary job-card"},Ll={class:"card-header jobs-header"},Al={class:"progress",style:{width:"90%"}},El=Rl(()=>s("div",{class:"card-body text-secondary jobs-body"},[s("p",{class:"card-text"})],-1));function Bl(e,t,i,u,o,a){return n(),l("div",Tl,[s("div",Ll,[p(_(i.job.name)+" ",1),s("button",{type:"button",class:"btn-close job-card-close","aria-label":"Close",onClick:t[0]||(t[0]=c=>a.close(i.job.id))}),s("div",Al,[s("div",{class:"progress-bar bg-success",role:"progressbar",style:L("width: "+this.pctComplete+"%")},null,4),s("div",{class:"progress-bar bg-secondary",role:"progressbar",style:L("width: "+this.pctRemaining+"%")},null,4),s("div",{class:"progress-bar bg-danger",role:"progressbar",style:L("width: "+this.pctFailed+"%")},null,4)])]),El])}var Vl=F(Ul,[["render",Bl],["__scopeId","data-v-1c704475"]]);const jl={props:[],data(){return{}},computed:$({},C({uiOptions:e=>e.configuration.uiOptions,jobs:e=>e.jobs.jobs,jobsIds:e=>e.jobs.jobsIds})),mounted(){},methods:{onDeletedJobItem(e){this.$store.dispatch("jobs/removeJob",{jobId:e})},getJob(e){return this.jobs[e]}},components:{JobItem:Vl}},ql={class:"upload-report-list"};function Wl(e,t,i,u,o,a){const c=S("JobItem");return n(),l("div",null,[s("div",ql,[(n(!0),l(I,null,w(e.jobsIds,r=>(n(),U(c,{job:this.getJob(r),key:r,href:r,onDeletedJob:a.onDeletedJobItem},null,8,["job","href","onDeletedJob"]))),128))])])}var Jl=F(jl,[["render",Wl],["__scopeId","data-v-11af2468"]]),zl="assets/orthanc.0a9a8203.png";const Hl={props:[],emits:[],data(){return{selectedModality:null,modalitiesEchoStatus:{}}},computed:R($({},C({uiOptions:e=>e.configuration.uiOptions,system:e=>e.configuration.system,queryableDicomModalities:e=>e.configuration.queryableDicomModalities,queryableDicomWebServers:e=>e.configuration.queryableDicomWebServers,studiesIds:e=>e.studies.studiesIds,statistics:e=>e.studies.statistics,jobs:e=>e.jobs.jobsIds})),{hasQueryableDicomWebServers(){return!1},hasQueryableDicomModalities(){return this.queryableDicomModalities.length>0},hasAccessToSettings(){return this.uiOptions.EnableSettings},hasJobs(){return this.jobs.length>0},displayedStudyCount(){return this.studiesIds.length},orthancApiUrl(){return m}}),methods:{selectModality(e){this.selectedModality=e},isSelectedModality(e){return this.selectedModality===e},isEchoRunning(e){return this.modalitiesEchoStatus[e]==null},isEchoSuccess(e){return this.modalitiesEchoStatus[e]==!0}},mounted(){this.$refs["modalities-collapsible"].addEventListener("show.bs.collapse",e=>{for(const t of this.queryableDicomModalities)this.modalitiesEchoStatus[t]=null;for(const t of this.queryableDicomModalities)b.remoteModalityEcho(t).then(i=>{this.modalitiesEchoStatus[t]=!0}).catch(()=>{this.modalitiesEchoStatus[t]=!1})})},components:{UploadHandler:Nl,JobsList:Jl}},x=e=>(O("data-v-5babd7f6"),e=e(),N(),e),Gl={class:"nav-side-menu"},Ql=x(()=>s("div",null,[s("img",{class:"orthanc-logo",src:zl,height:"48"})],-1)),Yl={key:0,class:"orthanc-name"},Kl={class:"menu-list"},Zl={id:"menu-content",class:"menu-content collapse out"},Xl={class:"d-flex align-items-center fix-router-link"},er=x(()=>s("i",{class:"fa fa-x-ray fa-lg menu-icon"},null,-1)),tr=p("Local studies "),sr={class:"study-count ms-auto"},ir={key:0,class:"d-flex align-items-center","data-bs-toggle":"collapse","data-bs-target":"#upload-handler"},or=x(()=>s("i",{class:"fa fa-file-upload fa-lg menu-icon"},null,-1)),ar=p("Upload "),nr=x(()=>s("span",{class:"ms-auto"},null,-1)),lr=[or,ar,nr],rr={key:1,class:"collapse",id:"upload-handler"},dr={key:2,class:"d-flex align-items-center","data-bs-toggle":"collapse","data-bs-target":"#modalities-list"},ur=x(()=>s("i",{class:"fa fa-radiation fa-lg menu-icon"},null,-1)),cr=p("DICOM Modalities "),hr=x(()=>s("span",{class:"arrow ms-auto"},null,-1)),pr=[ur,cr,hr],_r={class:"sub-menu collapse",id:"modalities-list",ref:"modalities-collapsible"},yr=["onClick"],fr={key:0,class:"ms-auto spinner-border spinner-border-sm","data-bs-toggle":"tooltip",title:"Checking connectivity"},mr={key:1,class:"ms-auto"},br=x(()=>s("i",{class:"bi bi-check2 text-success echo-status","data-bs-toggle":"tooltip",title:"C-Echo succeeded"},null,-1)),gr=[br],Sr={key:2,class:"ms-auto"},Dr=x(()=>s("i",{class:"bi bi-x-lg text-danger echo-status","data-bs-toggle":"tooltip",title:"C-Echo failed"},null,-1)),vr=[Dr],Ir={key:3,class:"d-flex align-items-center","data-bs-toggle":"collapse","data-bs-target":"#dicomweb-servers-list"},wr=x(()=>s("i",{class:"fa fa-globe fa-lg menu-icon"},null,-1)),Fr=p("DICOM-Web Servers "),Mr=x(()=>s("span",{class:"arrow ms-auto"},null,-1)),Pr=[wr,Fr,Mr],$r={class:"sub-menu collapse",id:"dicomweb-servers-list"},xr={href:"#"},kr={key:4,class:"d-flex align-items-center fix-router-link"},Cr=x(()=>s("i",{class:"fa fa-cogs fa-lg menu-icon"},null,-1)),Or=p("Settings "),Nr={key:5,class:"d-flex align-items-center fix-router-link"},Ur=["href"],Rr=x(()=>s("i",{class:"fa fa-solid fa-backward fa-lg menu-icon"},null,-1)),Tr=p("Legacy UI "),Lr=[Rr,Tr],Ar=x(()=>s("span",{class:"ms-auto"},null,-1)),Er={key:6,class:"d-flex align-items-center"},Br=x(()=>s("a",{href:"#"},[s("i",{class:"fa fa-solid fa-bars-progress fa-lg menu-icon"}),p("My jobs ")],-1)),Vr=x(()=>s("span",{class:"ms-auto"},null,-1)),jr=[Br,Vr],qr={key:7,class:"collapse show",id:"jobs-list"};function Wr(e,t,i,u,o,a){const c=S("router-link"),r=S("UploadHandler"),d=S("JobsList");return n(),l("div",Gl,[Ql,e.uiOptions.ShowOrthancName?(n(),l("div",Yl,[s("p",null,_(e.system.Name),1)])):h("",!0),s("div",Kl,[s("ul",Zl,[s("li",Xl,[y(c,{class:"router-link",to:"/"},{default:f(()=>[er,tr,s("span",sr,_(a.displayedStudyCount)+" / "+_(e.statistics.CountStudies),1)]),_:1})]),e.uiOptions.EnableUpload?(n(),l("li",ir,lr)):h("",!0),e.uiOptions.EnableUpload?(n(),l("div",rr,[y(r)])):h("",!0),a.hasQueryableDicomModalities?(n(),l("li",dr,pr)):h("",!0),s("ul",_r,[(n(!0),l(I,null,w(e.queryableDicomModalities,D=>(n(),l("li",{key:D,class:g({active:this.isSelectedModality(D)}),onClick:j=>a.selectModality(D)},[y(c,{class:"router-link",to:{path:"/filtered-remote-studies",query:{remoteMode:"dicom",remoteSource:D}}},{default:f(()=>[p(_(D),1)]),_:2},1032,["to"]),this.isEchoRunning(D)?(n(),l("span",fr)):this.isEchoSuccess(D)?(n(),l("span",mr,gr)):(n(),l("span",Sr,vr))],10,yr))),128))],512),a.hasQueryableDicomWebServers?(n(),l("li",Ir,Pr)):h("",!0),s("ul",$r,[(n(!0),l(I,null,w(e.queryableDicomWebServers,D=>(n(),l("li",{key:D,class:"active"},[s("a",xr,_(D)+" (TODO)",1)]))),128))]),a.hasAccessToSettings?(n(),l("li",kr,[y(c,{class:"router-link",to:"/settings"},{default:f(()=>[Cr,Or]),_:1})])):h("",!0),e.uiOptions.EnableLinkToLegacyUi?(n(),l("li",Nr,[s("a",{href:this.orthancApiUrl+"app/explorer.html"},Lr,8,Ur),Ar])):h("",!0),a.hasJobs?(n(),l("li",Er,jr)):h("",!0),a.hasJobs?(n(),l("div",qr,[y(d)])):h("",!0)])])])}var A=F(Hl,[["render",Wr],["__scopeId","data-v-5babd7f6"]]);const Jr={},zr={class:"alert alert-danger",role:"alert"};function Hr(e,t){return n(),l("div",zr," Page not found ! ")}var Gr=F(Jr,[["render",Hr]]);console.log("Base URL for router: ",ee);const Qr=be({history:ge(ee),routes:[{path:"/",alias:"/index.html",components:{SideBarView:A,ContentView:ne}},{path:"/filtered-studies",components:{SideBarView:A,ContentView:ne}},{path:"/filtered-remote-studies",components:{SideBarView:A,ContentView:al}},{path:"/settings",components:{SideBarView:A,ContentView:Ot}},{path:"/:pathMatch(.*)",components:{SideBarView:A,ContentView:Gr}}]}),V=Se(xe);V.use(Qr);V.use(se);V.use(De);V.mount("#app");
